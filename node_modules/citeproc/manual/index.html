<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.9: http://docutils.sourceforge.net/" />
<title>The citeproc-js Citation Processor</title>
<style type="text/css">

.redback {
  background: #ffaaaa;
}

p.fixed {
  position: fixed;
  top: 0;
  right: 0;
  padding-right: 0.5em;
  padding-left: 0.5em;
  margin-right: 0.5em;
  border: solid black 1px;
  background: white;
}

body { 
    width: 750px; 
    margin: auto; 
    position: center; 
    font-family: 'Lucida Sans', Verdana, sans-serif; 
    font-size: 10.5pt; 
    color: #434343;
    line-height: 135%; !important
}

.xml { padding: 1em; border: silver 1px solid; background: #EAFABC; }
.relaxngcompact { padding: 1em; border: silver 1px solid; background: #F6F9ED; }

.clothesline {
  position: relative;
}

.double-border {
  border: 5px double black;
}

h4 a {
  padding: 4px;
  border: 1px solid black;
}

/* .js { padding: 1em; border: silver 1px solid; background: #FFF68F; } */
.js { padding: 1em; border: silver 1px solid; background: #EAFABC; }
.text { padding: 1em; border: silver 1px solid; background: #FFcccc; }

dl { background: #B7FCE1; padding:1em; border: silver 1px solid;}
dt { font-weight: bold; margin-top: 0.5em; }

.info-version { text-align: center; font-size: 130%; font-weight: bold; }
.info-date { text-align: center; font-size: 110%; font-weight: bold; }
.title { text-align: center; margin: 4em 4em 1em 4em; }
.subtitle { text-align: center; margin: 1em 4em 4em 4em; }
.topic-title { font-weight: bold; font-size: 130%; }
.contents { margin-bottom: 1em; }
.center { text-align: center }



.contributors { margin-left: 250px; margin-top: 2em; margin-bottom: 2em; }
dl.contributors { background: white; border: none; }
.contributors dt { margin: 1em; }

span.sc {
  font-variant: small-caps;
  color: black;
}

tt.literal, tt.literal .pre {
  font-family: monospace;
  color: #232323;
  background: #d9d9d9;
  padding: 0px 2px 0px 2px;
}

div#table-of-contents tt.literal,
h1 tt.literal,
h2 tt.literal,
h3 tt.literal,
h4 tt.literal {
  background: white;
}

a { 
    border-bottom: dotted 1px #999; 
    text-decoration: none;
}

blockquote {
    background: #B7FCE1; 
    margin-left: 3em;
    padding:1em; 
    border: silver 1px solid;
}

blockquote.inline-wrapper {
    background: white;
    margin: 0px;
    padding: 0px;
    border: 1px none black;
    text-align: center;
}

blockquote.inline-wrapper div {
    display: inline;
}

blockquote.inline-wrapper p {
    vertical-align: top;
    display: inline;
}

.superscript {
  margin-bottom: 1em;
}

a.toc-backref tt.literal .pre {
    background: white;
}


a:link { color: #636363; font-weight: bold;}
a:visited { color: #636363; font-weight: bold; }
a:active { color: #636363; font-weight: bold; }
a:hover { color: #a30826; font-weight: bold; }

a tt.literal .pre:link { color: #131313; }
a tt.literal .pre:visited { color: #131313; }
a tt.literal .pre:active { color: #131313; }
a tt.literal .pre:hover { color: #a30826; }

.contents a:link { color: #434343; font-weight: normal; }
.contents a:visited { color: #434343; font-weight: normal; }
.contents a:active { color: #434343; font-weight: normal; }
.contents a:hover { color: #a30826; }

a.toc-backref:link { color: black; } 
a.toc-backref:visited { color: black; } 
a.toc-backref:active { color: black; } 
a.toc-backref:hover { color: #a30826; }

blockquote.clothesline {
  position: relative;
  padding: 0px;
  margin: 0px;
  border: 0px none;
}

div.admonition {
  clear: both;
  border: 3px solid #c0c0c0;
  float: right;
  width: 37%;
  padding: 0px 5px 0px 5px;
  background: white;
  margin: -0.5em -0.5em 1em 5px;
}

blockquote.clothesline div.admonition {
  float: none;
  position: absolute;
  top: 0em;
  right: 0em;
}

div.admonition p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

div.admonition-important .admonition-title:before {
  content: url("important.png");
  padding-right: 5px;
}

div.admonition-hint .admonition-title:before {
  content: url("ktip.png");
  padding-right: 5px;
}

div.admonition p.admonition-title {
  font-weight: bold;
  font-size: 150%;
  border-bottom: 1px solid black;
  margin-top: 0px;
  margin-bottom: 0px;
  padding-top: 3px;
  padding-bottom: 3px;
}

table.footnote {
  background: #ffffdd;
  padding: 5px 0px 5px 0px;
  border: 1px solid #cccccc;
  margin: 0.3em 0px 0.3em 0px;
}

table.first {
  margin: 2.3em 0px 0.3em 0px;
}

table.hello { margin-left: 3em; }
table.hello td { padding: 3px; }
table.hello th { padding: 3px; background: #dddddd; }

table.footnote td.label {
  white-space: nowrap;
  padding-right: 0.3em;
}

a.fn-backref:before {
  content: url("2uparrow.png");
  padding-right: 2px;
}

a.footnote-reference {
  background: #ffffdd;
  padding: 5px 2px 0px 2px;
  white-space: nowrap;
}

a.footnote-reference:before {
  content: url("2downarrow.png");
  padding-right: 2px;
}

a.fn-backref {
  vertical-align: top;
}

/* .nx { color: red; font-weight: bold } */ /* Function name */

.c { color: #408080; font-style: italic } /* Comment */
.err { border: 1px solid #FF0000 } /* Error */

.k { color: #007020; font-weight: bold } /* Keyword  [DONE] */
.o { color: #666666 } /* Operator */
.cm { color: #408080; font-style: italic } /* Comment.Multiline */
.cp { color: #BC7A00 } /* Comment.Preproc */
.c1 { color: #408080; font-style: italic } /* Comment.Single */
.cs { color: #408080; font-style: italic } /* Comment.Special */
.gd { color: #A00000 } /* Generic.Deleted */
.ge { font-style: italic } /* Generic.Emph */
.gr { color: #FF0000 } /* Generic.Error */
.gh { color: #000080; font-weight: bold } /* Generic.Heading */
.gi { color: #00A000 } /* Generic.Inserted */
.go { color: #808080 } /* Generic.Output */
.gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.gs { font-weight: bold } /* Generic.Strong */
.gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.gt { color: #0040D0 } /* Generic.Traceback */
.kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.kp { color: #008000 } /* Keyword.Pseudo */
.kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.kt { color: #B00040 } /* Keyword.Type */
.m { color: #666666 } /* Literal.Number */
.s { color: #BA2121 } /* Literal.String */
.na { color: #7D9029 } /* Name.Attribute */
.nb { color: #008000 } /* Name.Builtin */
.nc { color: #0000FF; font-weight: bold } /* Name.Class */
.no { color: #880000 } /* Name.Constant */
.nd { color: #AA22FF } /* Name.Decorator */
.ni { color: #999999; font-weight: bold } /* Name.Entity */
.ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.nf { color: #0000FF } /* Name.Function */
.nl { color: #A0A000 } /* Name.Label */
.nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.nt { color: #008000; font-weight: bold } /* Name.Tag */
.nv { color: #19177C } /* Name.Variable */
.ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.w { color: #bbbbbb } /* Text.Whitespace */
.mf { color: #666666 } /* Literal.Number.Float */
.mh { color: #666666 } /* Literal.Number.Hex */
.mi { color: #666666 } /* Literal.Number.Integer */
.mo { color: #666666 } /* Literal.Number.Oct */
.sb { color: #BA2121 } /* Literal.String.Backtick */
.sc { color: #BA2121 } /* Literal.String.Char */
.sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.s2 { color: #BA2121 } /* Literal.String.Double */
.se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.sh { color: #BA2121 } /* Literal.String.Heredoc */
.si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.sx { color: #008000 } /* Literal.String.Other */
.sr { color: #BB6688 } /* Literal.String.Regex */
.s1 { color: #BA2121 } /* Literal.String.Single */
.ss { color: #19177C } /* Literal.String.Symbol */
.bp { color: #008000 } /* Name.Builtin.Pseudo */
.vc { color: #19177C } /* Name.Variable.Class */
.vg { color: #19177C } /* Name.Variable.Global */
.vi { color: #19177C } /* Name.Variable.Instance */
.il { color: #666666 } /* Literal.Number.Integer.Long */

table.codeblock, tr.codeblock, td.linenos, td.codeblock, table.codeblock pre { 
	margin: 0; 
	padding: 0; 
	border: 0; 
	vertical-align: baseline; 
	border: none; 
}

td.linenos { 
	border-right: 1px solid #AAAAAA; 
	text-align: right; 
	color: #AAAAAA; 
	padding-right: 5px; 
	padding-left: 5px; 
}

.codeblock { font-size: 110%; }

td.codeblock { padding-left: 5px; }
pre.codeblock { }
pre.codeblock span.Normal { }

pre.codeblock span.DataType { color: #902000; }
pre.codeblock span.DecVal { color: #40a070; }
pre.codeblock span.BaseN { color: #40a070; }
pre.codeblock span.Float { color: #40a070; }
pre.codeblock span.Char { color: #4070a0; }
pre.codeblock span.String { color: #4070a0; }
pre.codeblock span.Comment { color: #60a0b0; font-style: italic; }
pre.codeblock span.Others { color: #007020; }
pre.codeblock span.Alert { color: red; font-weight: bold; }
pre.codeblock span.Function { color: #06287e; }
pre.codeblock span.RegionMarker { }
pre.codeblock span.Error { color: red; font-weight: bold; }

</style>
</head>
<body>
<div class="document" id="the-citeproc-js-citation-processor">
<h1 class="title">The <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> Citation Processor</h1>
<h2 class="subtitle" id="integrator-s-manual">Integrator's Manual</h2>

<p class="fixed"><a class="reference external" href="http://citationstylist.org/documentation/">CitationStylist.org</a></p>
<p class="info-version">version 1.00##a114##</p>
<p class="info-date">=D=26 September 2015=D=</p>
<dl class="contributors docutils">
<dt>Author of this manual</dt>
<dd><ul class="first last simple">
<li>Frank Bennett</li>
</ul>
</dd>
<dt>With important feedback from</dt>
<dd><ul class="first last simple">
<li>Bruce D'Arcus</li>
<li>Nick Bart</li>
<li>Lennard Fuller</li>
<li>Fergus Gallagher</li>
<li>Emiliano Heyns</li>
<li>Simon Kornblith</li>
<li>Carles Pina</li>
<li>Dan Stillman</li>
<li>Rintze Zelle</li>
</ul>
</dd>
</dl>
<hr class="docutils" />
<div class="contents topic" id="table-of-contents">
<p class="topic-title first">Table of Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#introduction" id="id51">Introduction</a></li>
<li><a class="reference internal" href="#setup-and-system-requirements" id="id52">Setup and System Requirements</a><ul>
<li><a class="reference internal" href="#getting-the-citeproc-js-sources" id="id53">Getting the <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> sources</a></li>
<li><a class="reference internal" href="#obtaining-the-standard-test-fixtures" id="id54">Obtaining the Standard Test Fixtures</a></li>
<li><a class="reference internal" href="#obtaining-the-locale-files" id="id55">Obtaining the Locale Files</a></li>
<li><a class="reference internal" href="#javascript-interpreters" id="id56">JavaScript interpreters</a></li>
<li><a class="reference internal" href="#loading-runtime-code" id="id57">Loading runtime code</a></li>
</ul>
</li>
<li><a class="reference internal" href="#processor-modes" id="id58">Processor modes</a></li>
<li><a class="reference internal" href="#readable-flags" id="id59">Readable Flags</a><ul>
<li><a class="reference internal" href="#opt-sort-citations" id="id60"><tt class="docutils literal">opt.sort_citations</tt></a></li>
<li><a class="reference internal" href="#opt-citation-number-sort" id="id61"><tt class="docutils literal">opt.citation_number_sort</tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-the-processor" id="id62">Running the processor</a><ul>
<li><a class="reference internal" href="#instantiation-csl-engine" id="id63">Instantiation: <tt class="docutils literal">CSL.Engine()</tt></a></li>
<li><a class="reference internal" href="#locally-defined-system-functions" id="id64">Locally defined system functions</a><ul>
<li><a class="reference internal" href="#required-sys-functions" id="id65">Required <tt class="docutils literal">sys</tt> functions</a><ul>
<li><a class="reference internal" href="#retrievelocale" id="id66"><tt class="docutils literal">retrieveLocale()</tt></a></li>
<li><a class="reference internal" href="#retrieveitem" id="id67"><tt class="docutils literal">retrieveItem()</tt></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#configuration-methods" id="id68">Configuration methods</a><ul>
<li><a class="reference internal" href="#general-configuration-methods" id="id69">General configuration methods</a><ul>
<li><a class="reference internal" href="#setoutputformat" id="id70"><tt class="docutils literal">setOutputFormat()</tt></a></li>
<li><a class="reference internal" href="#rebuildprocessorstate" id="id71"><tt class="docutils literal">rebuildProcessorState()</tt></a></li>
<li><a class="reference internal" href="#restoreprocessorstate" id="id72"><tt class="docutils literal">restoreProcessorState()</tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#multilingual-configuration-methods" id="id73">Multilingual configuration methods</a><ul>
<li><a class="reference internal" href="#citeproc-setlangprefsforcites" id="id74"><tt class="docutils literal">citeproc.setLangPrefsForCites()</tt></a></li>
<li><a class="reference internal" href="#citeproc-setlangprefsforciteaffixes" id="id75"><tt class="docutils literal">citeproc.setLangPrefsForCiteAffixes()</tt></a></li>
<li><a class="reference internal" href="#citeproc-setlangtagsforcsltransliteration" id="id76"><tt class="docutils literal">citeproc.setLangTagsForCslTransliteration()</tt></a></li>
<li><a class="reference internal" href="#citeproc-setlangtagsforcsltranslation" id="id77"><tt class="docutils literal">citeproc.setLangTagsForCslTranslation()</tt></a></li>
<li><a class="reference internal" href="#citeproc-setlangtagsforcslsort" id="id78"><tt class="docutils literal">citeproc.setLangTagsForCslSort()</tt></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#runtime-function-hooks" id="id79">Runtime function hooks</a><ul>
<li><a class="reference internal" href="#optional-sys-functions" id="id80">Optional <tt class="docutils literal">sys</tt> functions</a><ul>
<li><a class="reference internal" href="#getabbreviation" id="id81"><tt class="docutils literal">getAbbreviation()</tt></a></li>
<li><a class="reference internal" href="#sys-gethumanform" id="id82"><tt class="docutils literal">sys.getHumanForm()</tt></a></li>
<li><a class="reference internal" href="#sys-getlanguagename" id="id83"><tt class="docutils literal">sys.getLanguageName()</tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#legal-configuration-methods" id="id84">Legal configuration methods</a><ul>
<li><a class="reference internal" href="#citeproc-setsuppressedjurisdictions" id="id85"><tt class="docutils literal">citeproc.setSuppressedJurisdictions()</tt></a></li>
<li><a class="reference internal" href="#citeproc-retrievestylemodule" id="id86"><tt class="docutils literal">citeproc.retrieveStyleModule()</tt></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#loading-items-to-the-processor" id="id87">Loading items to the processor</a><ul>
<li><a class="reference internal" href="#updateitems" id="id88"><tt class="docutils literal">updateItems()</tt></a></li>
<li><a class="reference internal" href="#updateunciteditems" id="id89"><tt class="docutils literal">updateUncitedItems()</tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#generating-bibliographies" id="id90">Generating bibliographies</a><ul>
<li><a class="reference internal" href="#makebibliography" id="id91"><tt class="docutils literal">makeBibliography()</tt></a><ul>
<li><a class="reference internal" href="#return-value" id="id92">Return value</a></li>
<li><a class="reference internal" href="#selective-output" id="id93">Selective output</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#output-of-citations" id="id94">Output of citations</a><ul>
<li><a class="reference internal" href="#processcitationcluster" id="id95"><tt class="docutils literal">processCitationCluster()</tt></a></li>
<li><a class="reference internal" href="#appendcitationcluster" id="id96"><tt class="docutils literal">appendCitationCluster()</tt></a></li>
<li><a class="reference internal" href="#previewcitationcluster" id="id97"><tt class="docutils literal">previewCitationCluster()</tt></a></li>
</ul>
</li>
<li><a class="reference internal" href="#handling-items-with-no-rendered-form" id="id98">Handling items with no rendered form</a><ul>
<li><a class="reference internal" href="#no-bibliography-node-in-style" id="id99">No <tt class="docutils literal">bibliography</tt> node in style</a></li>
<li><a class="reference internal" href="#no-item-output-for-bibliography-entry" id="id100">No item output for bibliography entry</a></li>
<li><a class="reference internal" href="#no-output-for-citation" id="id101">No output for citation</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#data-input" id="id102">Data Input</a><ul>
<li><a class="reference internal" href="#item-fields" id="id103">Item fields</a><ul>
<li><a class="reference internal" href="#text-and-numeric-variables" id="id104">Text and numeric variables</a></li>
<li><a class="reference internal" href="#names" id="id105">Names</a><ul>
<li><a class="reference internal" href="#names-with-particles" id="id106">Names with particles</a></li>
<li><a class="reference internal" href="#names-with-an-articular" id="id107">Names with an articular</a></li>
<li><a class="reference internal" href="#non-byzantine-names" id="id108">&quot;non-Byzantine&quot; names</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dates" id="id109">Dates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#citation-data-object" id="id110">Citation data object</a><ul>
<li><a class="reference internal" href="#runtime-state-internal-objects-and-arrays" id="id111">Runtime state: Internal objects and arrays</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#dirty-tricks" id="id112">Dirty Tricks</a><ul>
<li><a class="reference internal" href="#supplementary-fields" id="id113">Supplementary fields</a></li>
<li><a class="reference internal" href="#input-data-rescue" id="id114">Input data rescue</a><ul>
<li><a class="reference internal" href="#id36" id="id115">Names</a><ul>
<li><a class="reference internal" href="#non-dropping-particle" id="id116"><tt class="docutils literal"><span class="pre">non-dropping-particle</span></tt></a></li>
<li><a class="reference internal" href="#dropping-particle" id="id117"><tt class="docutils literal"><span class="pre">dropping-particle</span></tt></a></li>
<li><a class="reference internal" href="#suffix-ordinary" id="id118"><tt class="docutils literal">suffix</tt> (ordinary)</a></li>
<li><a class="reference internal" href="#suffix-forced-comma" id="id119"><tt class="docutils literal">suffix</tt> (forced comma)</a></li>
<li><a class="reference internal" href="#dropping-particle-and-suffix" id="id120"><tt class="docutils literal"><span class="pre">dropping-particle</span></tt> and <tt class="docutils literal">suffix</tt></a></li>
<li><a class="reference internal" href="#particles-as-part-of-the-last-name" id="id121">Particles as part of the last name</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id37" id="id122">Dates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#processor-control" id="id123">Processor control</a><ul>
<li><a class="reference internal" href="#author-only" id="id124"><tt class="docutils literal"><span class="pre">author-only</span></tt></a></li>
<li><a class="reference internal" href="#suppress-author" id="id125"><tt class="docutils literal"><span class="pre">suppress-author</span></tt></a></li>
<li><a class="reference internal" href="#automating-text-insertions" id="id126">Automating text insertions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id43" id="id127">Multilingual content</a><ul>
<li><a class="reference internal" href="#selecting-multilingual-variants" id="id128">Selecting multilingual variants</a></li>
<li><a class="reference internal" href="#data-format" id="id129">Data format</a><ul>
<li><a class="reference internal" href="#title" id="id130">Title</a></li>
<li><a class="reference internal" href="#id46" id="id131">Names</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#date-parser" id="id132">Date parser</a><ul>
<li><a class="reference internal" href="#instantiation-csl-dateparser" id="id133">Instantiation: <tt class="docutils literal">CSL.DateParser</tt></a></li>
<li><a class="reference internal" href="#parser-methods" id="id134">Parser methods</a></li>
</ul>
</li>
<li><a class="reference internal" href="#test-suite" id="id135">Test Suite</a><ul>
<li><a class="reference internal" href="#running-the-test-suite" id="id136">Running the test suite</a></li>
<li><a class="reference internal" href="#fixture-layout" id="id137">Fixture layout</a></li>
</ul>
</li>
<li><a class="reference internal" href="#live-demo" id="id138">Live Demo</a></li>
</ul>
</div>
<hr class="docutils" />
<div class="section" id="introduction">
<h1><a class="toc-backref" href="#id51">Introduction</a></h1>
<p>This is the site administrator's manual for <tt class="docutils literal"><span class="pre">citeproc-js</span></tt>, a
JavaScript implementation of the <img alt="link" src="link.png" /> <a class="reference external" href="http://citationstyles.org/">Citation Style Language
(CSL)</a> <a class="footnote-reference" href="#id5" id="id2">[1]</a> The processor complies with version 1.0.1 of the CSL
specification, has been written and tested as an independent module,
and can be run by any ECMAscript-compliant interpreter. It has
deployed in browser plugins, desktop applications, and in server-side
configurations.</p>
<p>This manual covers the processor command set, the expected format of
input data, and placeholder functions to be supplied by the calling
application. <a class="footnote-reference" href="#id6" id="id4">[2]</a> In addition, notes are provided on the test suite, on
the infrastructure requirements for running the processor in
particular environments, and on extended functionality that is
available to address certain special requirements.</p>
<p>Comments regarding the processor and this document should be filed on
the <img alt="link" src="link.png" /> <a class="reference external" href="https://bitbucket.org/fbennett/citeproc-js/issues?status=new&amp;status=open">project issue tracker</a>.</p>
<table class="first docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[1]</a></td><td>The repository is currently housed at <a class="reference external" href="https://zotero.org/styles">zotero.org</a>.  Note that
styles in the Zotero styles repository are currently at CSL version
0.8.1.  Use the <a class="reference external" href="https://bitbucket.org/bdarcus/csl-utils/">tools provided by the CSL project</a> to convert CSL 0.8.1
styles to the version 1.0 syntax supported by this processor.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[2]</a></td><td>For further details on required infrastructure, see the sections
<a class="reference internal" href="#locally-defined-system-functions">Locally defined system functions</a>
and <a class="reference internal" href="#data-input">Data Input</a> below.</td></tr>
</tbody>
</table>
</div>
<div class="section" id="setup-and-system-requirements">
<h1><a class="toc-backref" href="#id52">Setup and System Requirements</a></h1>
<p>The processor is written in JavaScript, which lacks a standard I/O
method, and so must be wrapped in code for that purpose. If you get
stuck and want advice, or if you find something in this manual that is
out of date or just wrong, please feel free to post to the
<img alt="link" src="link.png" /> <a class="reference external" href="https://bitbucket.org/fbennett/citeproc-js/issues?status=new&amp;status=open">tracker</a>.</p>
<div class="section" id="getting-the-citeproc-js-sources">
<h2><a class="toc-backref" href="#id53">Getting the <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> sources</a></h2>
<p>The <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> sources are hosted on <img alt="link" src="link.png" /> <a class="reference external" href="http://bitbucket.org/fbennett/citeproc-js/">BitBucket</a>.
To obtain the sources, install the <img alt="link" src="link.png" /> <a class="reference external" href="http://mercurial.selenic.com/wiki/">Mercurial version control system</a>
on a computer within your control (if you're on a Linux distro or a Mac,
just do a package install), and run the following command:</p>
<blockquote>
<pre class="literal-block">
hg clone http://bitbucket.org/fbennett/citeproc-js/
</pre>
</blockquote>
<p>This should get you a copy of the sources, and you should be able to
exercise the test framework using the <tt class="docutils literal">./test.py</tt> script.</p>
</div>
<div class="section" id="obtaining-the-standard-test-fixtures">
<h2><a class="toc-backref" href="#id54">Obtaining the Standard Test Fixtures</a></h2>
<p>To run the test suite, the standard test fixtures must be added to the
processor source bundle.  To do so, enter the directory <tt class="docutils literal">./tests/fixtures</tt>,
and issue the following command:</p>
<blockquote>
<pre class="literal-block">
hg clone http://bitbucket.org/bdarcus/citeproc-test std
</pre>
</blockquote>
<p>Note the explicit target directory &quot;std&quot; following the repository
address.</p>
</div>
<div class="section" id="obtaining-the-locale-files">
<h2><a class="toc-backref" href="#id55">Obtaining the Locale Files</a></h2>
<p>The processor requires a set of standard CSL 1.0 locale files in order
to run.  These may be installed using the following command
(under Linux command line). From the root of the <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> source directory:</p>
<blockquote>
<pre class="literal-block">
git clone git://github.com/citation-style-language/locales.git locale
</pre>
</blockquote>
</div>
<div class="section" id="javascript-interpreters">
<h2><a class="toc-backref" href="#id56">JavaScript interpreters</a></h2>
<p>The processor will run in any modern ECMAscript (JavaScript)
interpreter.</p>
<p>To parse the XML files used to define locales and styles, the
processor relies on supplementary code, which must be loaded into the
same JavaScript context as the processor itself.  The <tt class="docutils literal">xmldom.js</tt>
and <tt class="docutils literal">xmljson.js</tt> files shipped with the processor source serve that
purpose. The <tt class="docutils literal">xmldom.js</tt> file is suitable for browser environments
or system that provide DOM support.  Use the <tt class="docutils literal">xmljson.js</tt> code in
environments (such as <tt class="docutils literal">node.js</tt> or a Firefox worker thread) where
native DOM is not available. The XML code of CSL locales and styles
can be converted to JSON on the fly using <a class="reference external" href="https://github.com/fbennett/csl-json-walker/blob/master/walker.js">csl-json-walker</a>
(JavaScript code that relies on DOM access) or by using <a class="reference external" href="https://bitbucket.org/fbennett/citeproc-js/src/tip/tools/makejson.py?at=default&amp;fileviewer=file-view-default">makejson.py</a>
(a Python script) for external pre-processing.</p>
<p>For an example of working code, the source behind the
<img alt="link" src="link.png" /> <a class="reference external" href="http://gsl-nagoya-u.net/http/pub/citeproc-demo/demo.html">processor demo page</a> may be useful as a reference.</p>
<p>Instructions on running the processor test suite can be found
in the section <a class="reference internal" href="#running-the-test-suite">Running the test suite</a> at the end of this manual.</p>
</div>
<div class="section" id="loading-runtime-code">
<h2><a class="toc-backref" href="#id57">Loading runtime code</a></h2>
<p>The primary source code of the processor is in the <tt class="docutils literal">./src</tt>
subdirectory.  Files for use in a runtime environment are catenated,
in the appropriate sequence, in the <tt class="docutils literal">citeproc.js</tt> file, located in
the root of the source archive.  This file and the test fixtures can
be refreshed using the <tt class="docutils literal">./test.py <span class="pre">-r</span></tt> command.</p>
<p>To build the processor, the <tt class="docutils literal">citeproc.js</tt> source code should be
loaded into the JavaScript interpreter context, together with a
<tt class="docutils literal">sys</tt> object provided by the integrator (see below), and the desired
CSL style (as a string).</p>
</div>
</div>
<div class="section" id="processor-modes">
<h1><a class="toc-backref" href="#id58">Processor modes</a></h1>
<p>The processor recognizes styles that validate under two separate
schemata, distinguished by the <tt class="docutils literal">version</tt> attribute on the <tt class="docutils literal">cs:style</tt>
node. Styles with <tt class="docutils literal"><span class="pre">version=&quot;1.0&quot;</span></tt> (or <tt class="docutils literal"><span class="pre">version=&quot;1.0.1&quot;</span></tt>) are assumed
to be valid under the <a class="reference external" href="http://docs.citationstyles.org/en/stable/specification.html">CSL Specification</a>, and by default the processor will
adopt internal settings that produce compliant output.</p>
<p>Styles with <tt class="docutils literal"><span class="pre">version=&quot;1.1mlz1&quot;</span></tt> are assumed to be valid under the
Juris-M Schema described in the <a class="reference external" href="http://citationstylist.org/docs/citeproc-js-csl.html">Juris-M (CSL-m) Specification
Supplement</a>. With this version setting, internal settings of the
processor will be adapted automatically to comply with the
expectations of Juris-M.</p>
</div>
<div class="section" id="readable-flags">
<h1><a class="toc-backref" href="#id59">Readable Flags</a></h1>
<p>The instantiated processor has several readable flags that can be used
by the calling application to shape the user interface to the
processor.  These include the following: <a class="footnote-reference" href="#id14" id="id13">[3]</a></p>
<div class="section" id="opt-sort-citations">
<h2><a class="toc-backref" href="#id60"><tt class="docutils literal">opt.sort_citations</tt></a></h2>
<p>True if the style is one that sorts citations in any way.</p>
</div>
<div class="section" id="opt-citation-number-sort">
<h2><a class="toc-backref" href="#id61"><tt class="docutils literal">opt.citation_number_sort</tt></a></h2>
<p>True if citations are sorted by citation</p>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id13">[3]</a></td><td>Note that these are information variables intended for reading
only; changing their value directly will have no effect on the
actual behavior of the processor.</td></tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="running-the-processor">
<h1><a class="toc-backref" href="#id62">Running the processor</a></h1>
<p>Instances of the processor are produced using <tt class="docutils literal">CSL.Engine()</tt> function.
Note that, as detailed below under <a class="reference internal" href="#locally-defined-system-functions">Locally defined system functions</a>,
certain local data access functions must be defined separately on an
object supplied to the processor as its first argument.</p>
<p>The instantiated processor provides a small set of runtime
configuration methods.  Instance methods are also used to load item
data into the processor, and to produce output objects suitable for
consumption by a word processor plugin, or for constructing
bibliographies.  Details of these and other methods available on
processor instances are given below.</p>
<div class="section" id="instantiation-csl-engine">
<h2><a class="toc-backref" href="#id63">Instantiation: <tt class="docutils literal">CSL.Engine()</tt></a></h2>
<p>The <tt class="docutils literal">CSL.Engine()</tt> command is invoked as shown below.  The command
takes up to four arguments (two are required, two optional):</p>
<div class="admonition-important admonition">
<p class="first admonition-title">Important</p>
<p class="last">See the section <a class="reference internal" href="#locally-defined-system-functions">Locally defined system functions</a> below for guidance
on the definition of the functions contained in the <tt class="docutils literal">sys</tt>
object.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">citeproc</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CSL</span><span class="p">.</span><span class="nx">Engine</span><span class="p">(</span><span class="nx">sys</span><span class="p">,</span>
                              <span class="nx">style</span><span class="p">,</span>
                              <span class="nx">lang</span><span class="p">,</span>
                              <span class="nx">forceLang</span><span class="p">)</span>
</pre></div>
</td></tr></table>
</div>
<dl class="docutils">
<dt><em>sys</em> (object)</dt>
<dd>A JavaScript object providing (at least) the functions
<tt class="docutils literal">retrieveLocale()</tt> and <tt class="docutils literal">retrieveItem()</tt>.</dd>
<dt><em>style</em> (xml string or object)</dt>
<dd>CSL style as serialized XML (if <tt class="docutils literal">xmldom.js</tt> is used)
or as JavaScript object (if <tt class="docutils literal">xmljson.js</tt> is used).</dd>
<dt><em>lang</em> (string, optional)</dt>
<dd>A language tag compliant with RFC 4646.  Defaults to <tt class="docutils literal">en</tt>.
Styles that contain a <tt class="docutils literal"><span class="pre">default-locale</span></tt> attribute value
on the <tt class="docutils literal">style</tt> node will ignore this option unless
the <tt class="docutils literal">forceLang</tt> argument is set to a non-nil value.</dd>
<dt><em>forceLang</em> (boolean, optional)</dt>
<dd>When set to a non-nil value, force the use of the
locale set in the <tt class="docutils literal">lang</tt> argument, overriding
any language set in the <tt class="docutils literal"><span class="pre">default-locale</span></tt> attribute
on the <tt class="docutils literal">style</tt> node.</dd>
</dl>
<p>The version of the processor itself can be obtained
from the attribute <tt class="docutils literal">processor_version</tt>.  The supported
CSL version can be obtained from <tt class="docutils literal">csl_version</tt>.</p>
</div>
<div class="section" id="locally-defined-system-functions">
<h2><a class="toc-backref" href="#id64">Locally defined system functions</a></h2>
<div class="section" id="required-sys-functions">
<h3><a class="toc-backref" href="#id65">Required <tt class="docutils literal">sys</tt> functions</a></h3>
<p>Two functions must be supplied to the processor upon instantiation on
the <tt class="docutils literal">sys</tt> object.  These functions are used by the processor to
obtain locale and item data from the environment.  Their exact
definition may vary.</p>
<div class="section" id="retrievelocale">
<h4><a class="toc-backref" href="#id66"><tt class="docutils literal">retrieveLocale()</tt></a></h4>
<p>The <tt class="docutils literal">retrieveLocale()</tt> function is used internally to retrieve the
serialized XML (or JavaScript object, if <tt class="docutils literal">xmljson.js</tt> is used) of a
given locale.  It takes a single RFC 4646 compliant language tag as
argument, composed of a single language tag (<tt class="docutils literal">en</tt>) or of a language
tag and region subtag (<tt class="docutils literal"><span class="pre">en-US</span></tt>).</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="nx">sys</span><span class="p">.</span><span class="nx">retrieveLocale</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">lang</span><span class="p">){</span>
        <span class="k">return</span> <span class="nx">DATA</span><span class="p">.</span><span class="nx">_locales</span><span class="p">[</span><span class="nx">lang</span><span class="p">];</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="retrieveitem">
<h4><a class="toc-backref" href="#id67"><tt class="docutils literal">retrieveItem()</tt></a></h4>
<p>The <tt class="docutils literal">retrieveItem()</tt> function is used by the processor to fetch
individual items from storage. The function must be synchronous with
the processor.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="nx">sys</span><span class="p">.</span><span class="nx">retrieveItem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">){</span>
        <span class="k">return</span> <span class="nx">DATA</span><span class="p">.</span><span class="nx">_items</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
<span class="p">};</span>
</pre></div>
</td></tr></table>
</div>
</div>
</div>
</div>
<div class="section" id="configuration-methods">
<h2><a class="toc-backref" href="#id68">Configuration methods</a></h2>
<div class="section" id="general-configuration-methods">
<h3><a class="toc-backref" href="#id69">General configuration methods</a></h3>
<div class="section" id="setoutputformat">
<h4><a class="toc-backref" href="#id70"><tt class="docutils literal">setOutputFormat()</tt></a></h4>
<p>The default output format of the processor is HTML. Output formats for
RTF and plain text are defined in the distribution source file
<tt class="docutils literal">./src/formats.js</tt>.  Additional formats can be added if desired.
See <img alt="link" src="link.png" /> <a class="reference external" href="http://bitbucket.org/fbennett/citeproc-js/src/tip/src/formats.js">the file itself</a> for details; it's pretty
straightforward.</p>
<p>The output format of the processor can be changed to any of the
defined formats after instantiation, using the <tt class="docutils literal">setOutputFormat()</tt>
command:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nx">citeproc</span><span class="p">.</span><span class="nx">setOutputFormat</span><span class="p">(</span><span class="s2">&quot;rtf&quot;</span><span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="rebuildprocessorstate">
<h4><a class="toc-backref" href="#id71"><tt class="docutils literal">rebuildProcessorState()</tt></a></h4>
<p>Rebuilds the processor from scratch, based on a cached list of
citation objects. In a dynamic application, once the internal state of
processor is established, citations should edited with individual
invocations of <tt class="docutils literal">processCitationCluster()</tt>.</p>
<p>Returns an array of <tt class="docutils literal">[citationID,noteIndex,string]</tt> triples in
document order, where <tt class="docutils literal">string</tt> is the fully disambiguated citation
cluster for the given document position.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nx">citeproc</span><span class="p">.</span><span class="nx">rebuildProcessorState</span><span class="p">(</span><span class="nx">citations</span><span class="p">,</span> <span class="nx">mode</span><span class="p">,</span> <span class="nx">uncitedItemIDs</span><span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<dl class="docutils">
<dt><strong>citations</strong> (object, optional)</dt>
<dd><p class="first">An array of citation input objects in document order. Each
citation object must be in the following form, with correct
values for <tt class="docutils literal">citationID</tt>, for each <tt class="docutils literal">id</tt>, and for <tt class="docutils literal">noteIndex</tt>.
Set <tt class="docutils literal">noteIndex</tt> to <tt class="docutils literal">0</tt> for in-text citations.
Default is to return an empty document update array.</p>
<div class="last"><div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>
   <span class="s2">&quot;citationID&quot;</span><span class="o">:</span> <span class="s2">&quot;CITATION-1&quot;</span><span class="p">,</span>
   <span class="s2">&quot;citationItems&quot;</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;ITEM-1&quot;</span>
      <span class="p">}</span>
   <span class="p">],</span>
   <span class="s2">&quot;properties&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;noteIndex&quot;</span><span class="o">:</span> <span class="mi">1</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div></dd>
<dt><strong>mode</strong> (string, optional)</dt>
<dd>One of <tt class="docutils literal">text</tt>, <tt class="docutils literal">html</tt> or <tt class="docutils literal">rtf</tt>. The default is <tt class="docutils literal">html</tt>.
After invocation, the processor is returned to its previous
output mode setting.</dd>
<dt><strong>uncitedItemIDs</strong> (array, optional)</dt>
<dd>An array of item IDs for uncited items to be included in
the document bibliography, if any.</dd>
</dl>
</div>
<div class="section" id="restoreprocessorstate">
<h4><a class="toc-backref" href="#id72"><tt class="docutils literal">restoreProcessorState()</tt></a></h4>
<p>This function is deprecated. Use <tt class="docutils literal">rebuildProcessorState()</tt> instead.</p>
</div>
</div>
<div class="section" id="multilingual-configuration-methods">
<h3><a class="toc-backref" href="#id73">Multilingual configuration methods</a></h3>
<div class="section" id="citeproc-setlangprefsforcites">
<h4><a class="toc-backref" href="#id74"><tt class="docutils literal">citeproc.setLangPrefsForCites()</tt></a></h4>
<p>This function is used in Juris-M. Pending documentation here, please
refer to the <a class="reference external" href="https://github.com/juris-m/zotero">Juris-M source code</a> for examples of its use.</p>
</div>
<div class="section" id="citeproc-setlangprefsforciteaffixes">
<h4><a class="toc-backref" href="#id75"><tt class="docutils literal">citeproc.setLangPrefsForCiteAffixes()</tt></a></h4>
<p>This function is used in Juris-M. Pending documentation here, please
refer to the <a class="reference external" href="https://github.com/juris-m/zotero">Juris-M source code</a> for examples of its use.</p>
</div>
<div class="section" id="citeproc-setlangtagsforcsltransliteration">
<h4><a class="toc-backref" href="#id76"><tt class="docutils literal">citeproc.setLangTagsForCslTransliteration()</tt></a></h4>
<p>This function is used in Juris-M. Pending documentation here, please
refer to the <a class="reference external" href="https://github.com/juris-m/zotero">Juris-M source code</a> for examples of its use.</p>
</div>
<div class="section" id="citeproc-setlangtagsforcsltranslation">
<h4><a class="toc-backref" href="#id77"><tt class="docutils literal">citeproc.setLangTagsForCslTranslation()</tt></a></h4>
<p>This function is used in Juris-M. Pending documentation here, please
refer to the <a class="reference external" href="https://github.com/juris-m/zotero">Juris-M source code</a> for examples of its use.</p>
</div>
<div class="section" id="citeproc-setlangtagsforcslsort">
<h4><a class="toc-backref" href="#id78"><tt class="docutils literal">citeproc.setLangTagsForCslSort()</tt></a></h4>
<p>This function is used in Juris-M. Pending documentation here, please
refer to the <a class="reference external" href="https://github.com/juris-m/zotero">Juris-M source code</a> for examples of its use.</p>
</div>
</div>
</div>
<div class="section" id="runtime-function-hooks">
<h2><a class="toc-backref" href="#id79">Runtime function hooks</a></h2>
<div class="section" id="optional-sys-functions">
<h3><a class="toc-backref" href="#id80">Optional <tt class="docutils literal">sys</tt> functions</a></h3>
<div class="section" id="getabbreviation">
<h4><a class="toc-backref" href="#id81"><tt class="docutils literal">getAbbreviation()</tt></a></h4>
<p>The optional <tt class="docutils literal">getAbbreviation()</tt> function returns short-forms
and other transforms of field content. Its signature is as follows:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="nx">citeproc</span><span class="p">.</span><span class="nx">sys</span><span class="p">.</span><span class="nx">getAbbreviation</span><span class="p">(</span>
    <span class="nx">styleID</span><span class="p">,</span>
    <span class="nx">cacheObject</span><span class="p">,</span>
    <span class="nx">jurisdiction</span><span class="p">,</span>
    <span class="nx">category</span><span class="p">,</span>
    <span class="nx">key</span><span class="p">,</span>
    <span class="nx">noHints</span>
<span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<dl class="docutils">
<dt><em>styleID</em> (required)</dt>
<dd>A machine-readable identifier for the current style. This
allows the function to associate abbreviation sets with
particular styles.</dd>
<dt><em>cacheObject</em> (object, required)</dt>
<dd>A JavaScript object from which cached values can be obtained.
Caching may be desired when very large abbreviation lists are
used.</dd>
<dt><em>jurisdiction</em> (string, required)</dt>
<dd>Either <tt class="docutils literal">default</tt> or, for legal resources only, a jurisdiction
code drawn from the <a class="reference external" href="http://fbennett.github.io/legal-resource-registry/">LegalResourceRegistry</a>.</dd>
<dt><em>category</em> (string, required)</dt>
<dd><p class="first">The abbreviation category of the field to be matched. Categories
and their associated variables are as follows:</p>
<dl class="last docutils">
<dt><strong>title</strong></dt>
<dd>The title category includes <tt class="docutils literal">genre</tt>, <tt class="docutils literal">event</tt>, <tt class="docutils literal">medium</tt>
and <tt class="docutils literal"><span class="pre">title-short</span></tt>, as well as <tt class="docutils literal">title</tt> itself.</dd>
<dt><strong>collection-title</strong></dt>
<dd>This category includes <tt class="docutils literal">archive</tt> in addition to
<tt class="docutils literal"><span class="pre">collection-title</span></tt>.</dd>
<dt><strong>container-title</strong></dt>
<dd>Only the <tt class="docutils literal"><span class="pre">container-title</span></tt> variable itself is in this category.</dd>
<dt><strong>place</strong></dt>
<dd>Place variables are: <tt class="docutils literal"><span class="pre">publisher-place</span></tt>, <tt class="docutils literal"><span class="pre">event-place</span></tt>,
<tt class="docutils literal">jurisdiction</tt>, <tt class="docutils literal"><span class="pre">archive-place</span></tt>, <tt class="docutils literal"><span class="pre">language-name</span></tt>,
<tt class="docutils literal"><span class="pre">language-name-original</span></tt>.</dd>
<dt><strong>institution-part</strong></dt>
<dd>Institution names in Juris-M may contain multiple elements,
separated by a pipe (aka field separator) <tt class="docutils literal">|</tt>. Individual
elements of any institution name are in this category, which
in Juris-M includes the <tt class="docutils literal">publisher</tt> and <tt class="docutils literal">authority</tt> variables.</dd>
<dt><strong>institution-entire</strong></dt>
<dd>The full form of Juris-M institution names is in this category.</dd>
<dt><strong>number</strong></dt>
<dd>All number variables. In standard CSL these are
<tt class="docutils literal"><span class="pre">chapter-number</span></tt>, <tt class="docutils literal"><span class="pre">collection-number</span></tt>, <tt class="docutils literal">edition</tt>,
<tt class="docutils literal">issue</tt>, <tt class="docutils literal">number</tt>, <tt class="docutils literal"><span class="pre">number-of-pages</span></tt>,
<tt class="docutils literal"><span class="pre">number-of-volumes</span></tt>, <tt class="docutils literal">volume</tt> and <tt class="docutils literal">number</tt>. In Juris-M,
the following are also numbers: <tt class="docutils literal"><span class="pre">call-number</span></tt>, <tt class="docutils literal">page</tt>,
<tt class="docutils literal"><span class="pre">page-first</span></tt>, <tt class="docutils literal">supplement</tt>,
<tt class="docutils literal"><span class="pre">publication-number</span></tt>. Abbreviation is attempted only when
the variable content tests <tt class="docutils literal">false</tt> for CSL <tt class="docutils literal"><span class="pre">is-numeric</span></tt>.</dd>
</dl>
</dd>
<dt><em>key</em> (string, required)</dt>
<dd>The field content to be abbreviated.</dd>
<dt><em>noHints</em> (boolean, required)</dt>
<dd>The function may propose abbreviated forms for newly-encountered
keys, using a list of words and phrases. When this toggle is set
to <tt class="docutils literal">true</tt>, this &quot;hinted&quot; abbreviation is suppressed. The processor
sets this toggle on titles and short titles of non-legal items.</dd>
</dl>
</div>
<div class="section" id="sys-gethumanform">
<h4><a class="toc-backref" href="#id82"><tt class="docutils literal">sys.getHumanForm()</tt></a></h4>
<p>This function is used in Juris-M. Pending documentation here, please
refer to the <a class="reference external" href="https://github.com/juris-m/zotero">Juris-M source code</a> for examples of its use.</p>
</div>
<div class="section" id="sys-getlanguagename">
<h4><a class="toc-backref" href="#id83"><tt class="docutils literal">sys.getLanguageName()</tt></a></h4>
<p>This function is used in Juris-M. Pending documentation here, please
refer to the <a class="reference external" href="https://github.com/juris-m/zotero">Juris-M source code</a> for examples of its use.</p>
</div>
</div>
<div class="section" id="legal-configuration-methods">
<h3><a class="toc-backref" href="#id84">Legal configuration methods</a></h3>
<div class="section" id="citeproc-setsuppressedjurisdictions">
<h4><a class="toc-backref" href="#id85"><tt class="docutils literal">citeproc.setSuppressedJurisdictions()</tt></a></h4>
<p>This function is used in Juris-M. Pending documentation here, please
refer to the <a class="reference external" href="https://github.com/juris-m/zotero">Juris-M source code</a> for examples of its use.</p>
</div>
<div class="section" id="citeproc-retrievestylemodule">
<h4><a class="toc-backref" href="#id86"><tt class="docutils literal">citeproc.retrieveStyleModule()</tt></a></h4>
<p>This function is used in Juris-M. Pending documentation here, please
refer to the <a class="reference external" href="https://github.com/juris-m/zotero">Juris-M source code</a> for examples of its use.</p>
</div>
</div>
</div>
<div class="section" id="loading-items-to-the-processor">
<h2><a class="toc-backref" href="#id87">Loading items to the processor</a></h2>
<div class="section" id="updateitems">
<h3><a class="toc-backref" href="#id88"><tt class="docutils literal">updateItems()</tt></a></h3>
<p>Before citations or a bibliography can be generated, an ordered list
of reference items must ordinarily be loaded into the processor using
the <tt class="docutils literal">updateItems()</tt> command, as shown below.  This command takes a
list of item IDs as its sole argument, and will reconcile the internal
state of the processor to the provided list of items, making any
necessary insertions and deletions, and making any necessary
adjustments to internal registers related to disambiguation and so
forth.</p>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">The sequence in which items are listed in the
argument to <tt class="docutils literal">updateItems()</tt> will ordinarily be reflected in the ordering
of bibliographies only if the style installed in the processor
does not impose its own sort order.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">my_ids</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;ID-1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ID-53&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ID-27&quot;</span>
<span class="p">]</span>

<span class="nx">citeproc</span><span class="p">.</span><span class="nx">updateItems</span><span class="p">(</span> <span class="nx">my_ids</span> <span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<p>To suppress sorting, give a second argument to the command
with a value of <tt class="docutils literal">true</tt>.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nx">citeproc</span><span class="p">.</span><span class="nx">updateItems</span><span class="p">(</span><span class="nx">my_ids</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<p>Note that only IDs may be used to identify items.  The ID is an
arbitrary, system-dependent identifier, used by the locally customized
<tt class="docutils literal">retrieveItem()</tt> method to retrieve
actual item data.</p>
</div>
<div class="section" id="updateunciteditems">
<h3><a class="toc-backref" href="#id89"><tt class="docutils literal">updateUncitedItems()</tt></a></h3>
<p>The <tt class="docutils literal">updateUncitedItems()</tt> command has the same interface
as <tt class="docutils literal">updateItems()</tt> (including the option to suppress sorting
by the style), but the reference items it adds are
not subject to deletion when no longer referenced by a
cite anywhere in the document.</p>
</div>
</div>
<div class="section" id="generating-bibliographies">
<h2><a class="toc-backref" href="#id90">Generating bibliographies</a></h2>
<div class="section" id="makebibliography">
<h3><a class="toc-backref" href="#id91"><tt class="docutils literal">makeBibliography()</tt></a></h3>
<p>The <tt class="docutils literal">makeBibliography()</tt> command does what its name implies.
If invoked without an argument,
it dumps a formatted bibliography containing all items currently
registered in the processor:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">mybib</span> <span class="o">=</span> <span class="nx">citeproc</span><span class="p">.</span><span class="nx">makeBibliography</span><span class="p">();</span>
</pre></div>
</td></tr></table>
</div>
<div class="admonition-important admonition" id="commands-categories">
<p class="first admonition-title">Important</p>
<p class="last">Matches against the content of name and date variables
are not possible, but empty fields can be matched for all
variable types.  See the <tt class="docutils literal">quash</tt> example below
for details.</p>
</div>
<div class="section" id="return-value">
<h4><a class="toc-backref" href="#id92">Return value</a></h4>
<p>The value returned by this command is a two-element list, composed of
a JavaScript array containing certain formatting parameters, and a
list of strings representing bibliography entries.  It is the responsibility
of the calling application to compose the list into a finish string
for insertion into the document.  The first
element —- the array of formatting parameters —- contains the key/value
pairs shown below (the values shown are the processor defaults in the
HTML output mode):</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">[</span>
   <span class="p">{</span>
      <span class="nx">maxoffset</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">entryspacing</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">linespacing</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">hangingindent</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">second</span><span class="o">-</span><span class="nx">field</span><span class="o">-</span><span class="nx">align</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">bibstart</span><span class="o">:</span> <span class="s2">&quot;&lt;div class=\&quot;csl-bib-body\&quot;&gt;\n&quot;</span><span class="p">,</span>
      <span class="nx">bibend</span><span class="o">:</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">,</span>
      <span class="nx">bibliography_errors</span><span class="o">:</span> <span class="p">[]</span>
   <span class="p">},</span>
   <span class="p">[</span>
      <span class="s2">&quot;&lt;div class=\&quot;csl-entry\&quot;&gt;Book A&lt;/div&gt;&quot;</span><span class="p">,</span>
      <span class="s2">&quot;&lt;div class=\&quot;csl-entry\&quot;&gt;Book C&lt;/div&gt;&quot;</span>
   <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</td></tr></table>
</div>
<dl class="docutils">
<dt><em>maxoffset</em></dt>
<dd>Some citation styles apply a label (either a number or an
alphanumeric code) to each bibliography entry, and use this label
to cite bibliography items in the main text.  In the bibliography,
the labels may either be hung in the margin, or they may be set
flush to the margin, with the citations indented by a uniform
amount to the right.  In the latter case, the amount of indentation
needed depends on the maximum width of any label.  The
<tt class="docutils literal">maxoffset</tt> value gives the maximum number of characters that
appear in any label used in the bibliography.  The client that
controls the final rendering of the bibliography string should use
this value to calculate and apply a suitable indentation length.</dd>
<dt><em>entryspacing</em></dt>
<dd>An integer representing the spacing between entries in the bibliography.</dd>
<dt><em>linespacing</em></dt>
<dd>An integer representing the spacing between the lines within
each bibliography entry.</dd>
<dt><em>hangingindent</em></dt>
<dd>The number of em-spaces to apply in hanging indents within the
bibliography.</dd>
<dt><em>second-field-align</em></dt>
<dd>When the <tt class="docutils literal"><span class="pre">second-field-align</span></tt> CSL option is set, this returns
either &quot;flush&quot; or &quot;margin&quot;.  The calling application should
align text in bibliography output as described in the <a class="reference external" href="http://citationstyles.org/downloads/specification.html#bibliography-specific-options">CSL specification</a>.
Where <tt class="docutils literal"><span class="pre">second-field-align</span></tt> is not set, this return value is set to <tt class="docutils literal">false</tt>.</dd>
<dt><em>bibstart</em></dt>
<dd>A string to be appended to the front of the finished bibliography
string.</dd>
<dt><em>bibend</em></dt>
<dd>A string to be appended to the end of the finished bibliography
string.</dd>
</dl>
</div>
<div class="section" id="selective-output">
<h4><a class="toc-backref" href="#id93">Selective output</a></h4>
<p>The <tt class="docutils literal">makeBibliography()</tt> command accepts one optional argument,
which is a nested JavaScript object that may contain
<em>one of</em> the objects <tt class="docutils literal">select</tt>, <tt class="docutils literal">include</tt> or <tt class="docutils literal">exclude</tt>, and
optionally an additional  <tt class="docutils literal">quash</tt> object.  Each of these four objects
is an array containing one or more objects with <tt class="docutils literal">field</tt> and <tt class="docutils literal">value</tt>
attributes, each with a simple string value (see the examples below).
The matching behavior for each of the four object types, with accompanying
input examples, is as follows:</p>
<dl class="docutils">
<dt><tt class="docutils literal">select</tt></dt>
<dd>For each item in the bibliography, try every match object in the array against
the item, and include the item if, and only if, <em>all</em> of the objects match.</dd>
</dl>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">The target field in the data items registered in the processor
may either be a string or an array.  In the latter case,
an array containing a value identical to the
relevant value is treated as a match.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">myarg</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s2">&quot;select&quot;</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;book&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>  <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;categories&quot;</span><span class="p">,</span>
          <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;1990s&quot;</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">mybib</span> <span class="o">=</span> <span class="nx">cp</span><span class="p">.</span><span class="nx">makeBibliography</span><span class="p">(</span><span class="nx">myarg</span><span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<dl class="docutils">
<dt><tt class="docutils literal">include</tt></dt>
<dd>Try every match object in the array against the item, and include the
item if <em>any</em> of the objects match.</dd>
</dl>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">myarg</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s2">&quot;include&quot;</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;book&quot;</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">mybib</span> <span class="o">=</span> <span class="nx">cp</span><span class="p">.</span><span class="nx">makeBibliography</span><span class="p">(</span><span class="nx">myarg</span><span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<dl class="docutils">
<dt><tt class="docutils literal">exclude</tt></dt>
<dd>Include the item if <em>none</em> of the objects match.</dd>
</dl>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">myarg</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s2">&quot;exclude&quot;</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;legal_case&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
         <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;legislation&quot;</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">mybib</span> <span class="o">=</span> <span class="nx">cp</span><span class="p">.</span><span class="nx">makeBibliography</span><span class="p">(</span><span class="nx">myarg</span><span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<dl class="docutils">
<dt><tt class="docutils literal">quash</tt></dt>
<dd>Regardless of the result from <tt class="docutils literal">select</tt>, <tt class="docutils literal">include</tt> or <tt class="docutils literal">exclude</tt>,
skip the item if <em>all</em> of the objects match.</dd>
</dl>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">An empty string given as the field value will match items
for which that field is missing or has a nil value.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">myarg</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s2">&quot;include&quot;</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;categories&quot;</span><span class="p">,</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;classical&quot;</span>
      <span class="p">}</span>
   <span class="p">],</span>
   <span class="s2">&quot;quash&quot;</span> <span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;type&quot;</span><span class="p">,</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;manuscript&quot;</span>
      <span class="p">},</span>
      <span class="p">{</span>
         <span class="s2">&quot;field&quot;</span> <span class="o">:</span> <span class="s2">&quot;issued&quot;</span><span class="p">,</span>
         <span class="s2">&quot;value&quot;</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span>
      <span class="p">}</span>
   <span class="p">]</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">mybib</span> <span class="o">=</span> <span class="nx">cp</span><span class="p">.</span><span class="nx">makeBibliography</span><span class="p">(</span><span class="nx">myarg</span><span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
</div>
</div>
</div>
<div class="section" id="output-of-citations">
<h2><a class="toc-backref" href="#id94">Output of citations</a></h2>
<p>The available citation commands are:</p>
<ul class="simple">
<li><a class="reference internal" href="#appendcitationcluster">appendCitationCluster()</a></li>
<li><a class="reference internal" href="#processcitationcluster">processCitationCluster()</a></li>
<li><a class="reference internal" href="#previewcitationcluster">previewCitationCluster()</a></li>
</ul>
<p>Citation commands generate strings for insertion into the text of a
target document.  Citations can be added to a document in one of two
ways: as a batch process (BibTeX, for example, works in this way) or
interactively (Endnote, Mendeley and Zotero work in this way, through
a connection to the user's word processing software).  These two modes
of operation are supported in <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> by two separate
commands, respectively <tt class="docutils literal">appendCitationCluster()</tt>, and
<tt class="docutils literal">processCitationCluster()</tt>.  <a class="footnote-reference" href="#id26" id="id25">[4]</a></p>
<p>The <tt class="docutils literal">appendCitationCluster()</tt> and
<tt class="docutils literal">processCitationCluster()</tt> commands use a similar input format
for citation data, which is described below in the <a class="reference internal" href="#data-input">Data Input</a>
→ <a class="reference internal" href="#citation-data-object">Citation data object</a> section below.</p>
<table class="docutils footnote" frame="void" id="id26" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id25">[4]</a></td><td>A third, simpler command (<tt class="docutils literal">makeCitationCluster()</tt>), is not
covered by this manual.  It is primarily useful as a tool for
testing the processor, as it lacks any facility for position
evaluation, which is needed in production environments.</td></tr>
</tbody>
</table>
<div class="section" id="processcitationcluster">
<h3><a class="toc-backref" href="#id95"><tt class="docutils literal">processCitationCluster()</tt></a></h3>
<p>The <tt class="docutils literal">processCitationCluster()</tt> command is used to generate and
maintain citations dynamically in the text of a document.  It takes three
arguments: a citation object, a list of citation ID/note index pairs
representing existing citations that precede the target citation, and
a similar list of pairs for citations coming after the target.  Like
the <tt class="docutils literal">appendCitationCluster()</tt> command run without a flag, its
return value is an array of two elements: a data object, and
an array of one or more index/string pairs, one for each citation
affected by the citation edit or insertion operation.  As shown below,
the data object currently has a single boolean value, <tt class="docutils literal">bibchange</tt>,
which indicates whether the document bibliography is in need of
refreshing as a result of the <tt class="docutils literal">processCitationCluster()</tt> operation.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">citationsPre</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="s2">&quot;citation-abc&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;citation-def&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="p">];</span>

<span class="kd">var</span> <span class="nx">citationsPost</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="s2">&quot;citation-ghi&quot;</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="p">];</span>

<span class="nx">citeproc</span><span class="p">.</span><span class="nx">processCitationCluster</span><span class="p">(</span><span class="nx">citation</span><span class="p">,</span><span class="nx">citationsPre</span><span class="p">,</span><span class="nx">citationsPost</span><span class="p">);</span>

<span class="p">...</span>

<span class="p">[</span>
   <span class="p">{</span>
     <span class="s2">&quot;bibchange&quot;</span><span class="o">:</span> <span class="kc">true</span>
   <span class="p">},</span>
   <span class="p">[</span>
      <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="s2">&quot;(Ronald Snoakes 1950)&quot;</span> <span class="p">],</span>
      <span class="p">[</span> <span class="mi">3</span><span class="p">,</span><span class="s2">&quot;(Richard Snoakes 1950)&quot;</span> <span class="p">]</span>
   <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</td></tr></table>
</div>
<p>A worked example showing the result of multiple transactions can be
found in the <img alt="link" src="link.png" /> <a class="reference external" href="http://bitbucket.org/bdarcus/citeproc-test/src/tip/processor-tests/humans/integration_IbidOnInsert.txt">processor test suite</a>.</p>
</div>
<div class="section" id="appendcitationcluster">
<h3><a class="toc-backref" href="#id96"><tt class="docutils literal">appendCitationCluster()</tt></a></h3>
<p>The <tt class="docutils literal">appendCitationCluster()</tt> command takes a single citation
object as argument, and an optional flag to indicate whether
a full list of bibliography items has already been registered
in the processor with the <tt class="docutils literal">updateItems()</tt> command.  If the flag
is true, the command should return an array containing exactly
one two-element array, consisting of the current index position
as the first element, and a string for insertion into the document
as the second.  To wit:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="nx">citeproc</span><span class="p">.</span><span class="nx">appendCitationCluster</span><span class="p">(</span><span class="nx">mycitation</span><span class="p">,</span><span class="kc">true</span><span class="p">);</span>

<span class="p">[</span>
   <span class="p">[</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;(J. Doe 2000)&quot;</span> <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</td></tr></table>
</div>
<p>If the flag is false, invocations of the command may return
multiple elements in the list, when the processor sense that
the additional bibliography items added by the citation require
changes to other citations to achieve disambiguation.  In this
case, a typical return value might look like this:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="nx">citeproc</span><span class="p">.</span><span class="nx">appendCitationCluster</span><span class="p">(</span><span class="nx">mycitation</span><span class="p">);</span>

<span class="p">[</span>
   <span class="p">[</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;(Jake Doe 2000)&quot;</span> <span class="p">],</span>
   <span class="p">[</span> <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;(John Doe 2000)&quot;</span> <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="previewcitationcluster">
<h3><a class="toc-backref" href="#id97"><tt class="docutils literal">previewCitationCluster()</tt></a></h3>
<p>The <tt class="docutils literal">previewCitationCluster()</tt> command takes the same arguments
as <tt class="docutils literal">processCitationCluster()</tt>, plus a flag to indicate the
output mode.</p>
<p>The return value is a string representing the
citation as it would be rendered in the specified context.  This command
will preview citations
exactly as they will appear in the document, and will have no
effect on processor state: the next edit will return updates
as if the preview command had not been run.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">citationsPre</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="s2">&quot;citation-abc&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;citation-def&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span> <span class="p">];</span>
<span class="kd">var</span> <span class="nx">citationsPost</span> <span class="o">=</span> <span class="p">[</span> <span class="p">[</span><span class="s2">&quot;citation-ghi&quot;</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span> <span class="p">];</span>

<span class="nx">citeproc</span><span class="p">.</span><span class="nx">previewCitationCluster</span><span class="p">(</span><span class="nx">citation</span><span class="p">,</span><span class="nx">citationsPre</span><span class="p">,</span><span class="nx">citationsPost</span><span class="p">,</span><span class="s2">&quot;html&quot;</span><span class="p">);</span>

<span class="p">...</span>

<span class="s2">&quot;(Richard Snoakes 1950)&quot;</span>
</pre></div>
</td></tr></table>
</div>
</div>
</div>
<div class="section" id="handling-items-with-no-rendered-form">
<h2><a class="toc-backref" href="#id98">Handling items with no rendered form</a></h2>
<p>The processor might fail to produce meaningful rendered output in three
situations:</p>
<ol class="arabic simple">
<li>When <a class="reference internal" href="#makebibliography">makeBibliography()</a> is run,
and the configured style contains no <tt class="docutils literal">bibliography</tt> node;</li>
<li>When <a class="reference internal" href="#makebibliography">makeBibliography()</a> is run, and no variable other than
<tt class="docutils literal"><span class="pre">citation-number</span></tt> produces output for an individual entry; or</li>
<li>When a <a class="reference internal" href="#output-of-citations">citation command</a> is used, but no element rendered for a
particular cite produces any output.</li>
</ol>
<p>The processor handles these three cases as described below.</p>
<div class="section" id="no-bibliography-node-in-style">
<h3><a class="toc-backref" href="#id99">No <tt class="docutils literal">bibliography</tt> node in style</a></h3>
<p>When the <a class="reference internal" href="#makebibliography">makeBibliography()</a> command is run on a style
that has no <tt class="docutils literal">bibliography</tt> node, the command returns
a value of <tt class="docutils literal">false</tt>.</p>
</div>
<div class="section" id="no-item-output-for-bibliography-entry">
<h3><a class="toc-backref" href="#id100">No item output for bibliography entry</a></h3>
<p>When the return value of the <a class="reference internal" href="#makebibliography">makeBibliography()</a> command contains
entries that produce no output other than for the (automatically
generated) <tt class="docutils literal"><span class="pre">citation-number</span></tt> variable, an error object with
ID and position information on the offending entry,
and a bitwise error code (always CSL.ERROR_NO_RENDERED_FORM, currently)
is pushed to the <tt class="docutils literal">bibliography_errors</tt> array in the data segment of the
return object:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">[</span>
   <span class="p">{</span>
      <span class="nx">maxoffset</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">entryspacing</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">linespacing</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">hangingindent</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">second</span><span class="o">-</span><span class="nx">field</span><span class="o">-</span><span class="nx">align</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">bibstart</span><span class="o">:</span> <span class="s2">&quot;&lt;div class=\&quot;csl-bib-body\&quot;&gt;\n&quot;</span><span class="p">,</span>
      <span class="nx">bibend</span><span class="o">:</span> <span class="s2">&quot;&lt;/div&gt;&quot;</span><span class="p">,</span>
      <span class="nx">bibliography_errors</span><span class="o">:</span> <span class="p">[</span>
         <span class="p">{</span>
            <span class="nx">index</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="nx">itemID</span><span class="o">:</span> <span class="s2">&quot;ITEM-2&quot;</span><span class="p">,</span>
            <span class="nx">error_code</span><span class="o">:</span> <span class="nx">CSL</span><span class="p">.</span><span class="nx">ERROR_NO_RENDERED_FORM</span>
         <span class="p">}</span>
      <span class="p">]</span>
   <span class="p">},</span>
   <span class="p">[</span>
      <span class="s2">&quot;[1] Snoakes, Big Book (2000)&quot;</span><span class="p">,</span>
      <span class="s2">&quot;[2] Doe, Bigger Book (2001)&quot;</span><span class="p">,</span>
      <span class="s2">&quot;[3] &quot;</span><span class="p">,</span>
      <span class="s2">&quot;[4] Roe, Her Book (2002)&quot;</span>
   <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</td></tr></table>
</div>
<p>The calling application may use the information in <tt class="docutils literal">bibliography_errors</tt>
to prompt the user concerning possible corrective action.</p>
</div>
<div class="section" id="no-output-for-citation">
<h3><a class="toc-backref" href="#id101">No output for citation</a></h3>
<p>When a citation processing command produces no output for a citation,
an error object with ID and position information on the offending
cite, and a bitwise error code (always
<tt class="docutils literal">CSL.ERROR_NO_RENDERED_FORM</tt>, currently) is pushed to the
<tt class="docutils literal">citation_errors</tt> array in the data segment of the return object.</p>
<p>Note that <tt class="docutils literal">previewCitationCluster()</tt> returns only a string value,
with no data segment; citation errors are not available with this
command.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">[</span>
   <span class="p">{</span>
     <span class="nx">bibchange</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
     <span class="nx">citation_errors</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
           <span class="nx">citationID</span><span class="o">:</span> <span class="s2">&quot;citationID_12345&quot;</span><span class="p">,</span>
           <span class="nx">index</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
           <span class="nx">noteIndex</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>           <span class="c1">// for example</span>
           <span class="nx">itemID</span><span class="o">:</span> <span class="s2">&quot;itemID_67890&quot;</span><span class="p">,</span>
           <span class="nx">citationItem_pos</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
           <span class="nx">error_code</span><span class="o">:</span> <span class="nx">CSL</span><span class="p">.</span><span class="nx">ERROR_NO_RENDERED_FORM</span>
        <span class="p">}</span>
     <span class="p">]</span>
   <span class="p">},</span>
   <span class="p">[</span>
      <span class="p">[</span> <span class="mi">1</span><span class="p">,</span><span class="s2">&quot;(Ronald Snoakes 1950)&quot;</span> <span class="p">],</span>
      <span class="p">[</span> <span class="mi">4</span><span class="p">,</span><span class="s2">&quot;[CSL STYLE ERROR: reference with no printed form.]&quot;</span> <span class="p">],</span>
      <span class="p">[</span> <span class="mi">5</span><span class="p">,</span><span class="s2">&quot;(Richard Snoakes 1950)&quot;</span> <span class="p">]</span>
   <span class="p">]</span>
<span class="p">]</span>
</pre></div>
</td></tr></table>
</div>
</div>
</div>
</div>
<div class="section" id="data-input">
<h1><a class="toc-backref" href="#id102">Data Input</a></h1>
<div class="section" id="item-fields">
<h2><a class="toc-backref" href="#id103">Item fields</a></h2>
<p>The locally defined <tt class="docutils literal">retrieveItem()</tt> function must return data
for the target item as a simple JavaScript array containing recognized
CSL fields. <a class="footnote-reference" href="#id34" id="id29">[5]</a>  The layout of the three field types is described below.</p>
<div class="section" id="text-and-numeric-variables">
<h3><a class="toc-backref" href="#id104">Text and numeric variables</a></h3>
<p>Text and numeric variables are not distinguished in the data layer; both
should be presented as simple strings.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;title&quot;</span> <span class="o">:</span> <span class="s2">&quot;My Anonymous Life&quot;</span><span class="p">,</span>
   <span class="s2">&quot;volume&quot;</span> <span class="o">:</span> <span class="s2">&quot;10&quot;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="names">
<span id="clean-names"></span><h3><a class="toc-backref" href="#id105">Names</a></h3>
<p>When present in the item data, CSL name variables must
be delivered as a list of JavaScript arrays, with one
array for each name represented by the variable.
Simple personal names are composed of <tt class="docutils literal">family</tt> and <tt class="docutils literal">given</tt> elements,
containing respectively the family and given name of the individual.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Doe&quot;</span><span class="p">,</span> <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Jonathan&quot;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Roe&quot;</span><span class="p">,</span> <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Jane&quot;</span> <span class="p">}</span>
  <span class="p">],</span>
  <span class="s2">&quot;editor&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Saunders&quot;</span><span class="p">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;John Bertrand de Cusance Morant&quot;</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>Institutional and other names that should always be presented
literally (such as &quot;The Artist Formerly Known as Prince&quot;,
&quot;Banksy&quot;, or &quot;Ramses IV&quot;) should be delivered as a single
<tt class="docutils literal">literal</tt> element in the name array:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;literal&quot;</span> <span class="o">:</span> <span class="s2">&quot;Society for Putting Things on Top of Other Things&quot;</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<div class="section" id="names-with-particles">
<h4><a class="toc-backref" href="#id106">Names with particles</a></h4>
<p>Name particles, such as the &quot;von&quot; in &quot;Werner von Braun&quot;, can
be delivered separately from the family and given name,
as <tt class="docutils literal"><span class="pre">dropping-particle</span></tt> and <tt class="docutils literal"><span class="pre">non-dropping-particle</span></tt> elements.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Humboldt&quot;</span><span class="p">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Alexander&quot;</span><span class="p">,</span>
      <span class="s2">&quot;dropping-particle&quot;</span> <span class="o">:</span> <span class="s2">&quot;von&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Gogh&quot;</span><span class="p">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Vincent&quot;</span><span class="p">,</span>
      <span class="s2">&quot;non-dropping-particle&quot;</span> <span class="o">:</span> <span class="s2">&quot;van&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Stephens&quot;</span><span class="p">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;James&quot;</span><span class="p">,</span>
      <span class="s2">&quot;suffix&quot;</span> <span class="o">:</span> <span class="s2">&quot;Jr.&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;van der Vlist&quot;</span><span class="p">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Eric&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="names-with-an-articular">
<h4><a class="toc-backref" href="#id107">Names with an articular</a></h4>
<p>Name suffixes such as the &quot;Jr.&quot; in &quot;Frank Bennett, Jr.&quot;  and the &quot;III&quot;
in &quot;Horatio Ramses III&quot; can be delivered as a <tt class="docutils literal">suffix</tt> element.</p>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">A simplified format for delivering particles and name suffixes
to the processor is described below in the section
<a class="reference internal" href="#dirty-tricks">Dirty Tricks</a> → <a class="reference internal" href="#input-data-rescue">Input data rescue</a> → <a class="reference internal" href="#dirty-names">Names</a>.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Bennett&quot;</span><span class="p">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Frank G.&quot;</span><span class="p">,</span>
      <span class="s2">&quot;suffix&quot;</span> <span class="o">:</span> <span class="s2">&quot;Jr.&quot;</span><span class="p">,</span>
      <span class="s2">&quot;comma-suffix&quot;</span><span class="o">:</span> <span class="s2">&quot;true&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Ramses&quot;</span><span class="p">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Horatio&quot;</span><span class="p">,</span>
      <span class="s2">&quot;suffix&quot;</span> <span class="o">:</span> <span class="s2">&quot;III&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>Note the use of the <tt class="docutils literal"><span class="pre">comma-suffix</span></tt> field in the example above.  This
hint must be included for suffixes that are preceded by a comma, which
render differently from &quot;ordinary&quot; suffixes in the ordinary long
form.</p>
</div>
<div class="section" id="non-byzantine-names">
<span id="input-byzantine"></span><h4><a class="toc-backref" href="#id108">&quot;non-Byzantine&quot; names</a></h4>
<p>Names not written in the Latin or Cyrillic
scripts <a class="footnote-reference" href="#id35" id="id31">[6]</a> are always displayed
with the family name first.  No special hint is needed in
the input data; the processor is sensitive to the character
set used in the name elements, and will handle such names
appropriately.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;村上&quot;</span><span class="p">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;春樹&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">When the romanized transliteration is selected from a multilingual
name field, the <tt class="docutils literal"><span class="pre">static-ordering</span></tt> flag is not required.  See the section
<a class="reference internal" href="#dirty-tricks">Dirty Tricks</a> → <a class="reference internal" href="#multilingual-content">Multilingual content</a> below for further details.</p>
</div>
<p>Sometimes it might be desired to handle a Latin or Cyrillic
transliteration as if it were a fixed (non-Byzantine) name.  This
behavior can be prompted by including a <tt class="docutils literal"><span class="pre">static-ordering</span></tt> element in
the name array.  The actual value of the element is irrelevant, so
long as it returns true when tested by the JavaScript interpreter.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Murakami&quot;</span><span class="p">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Haruki&quot;</span><span class="p">,</span>
      <span class="s2">&quot;static-ordering&quot;</span> <span class="o">:</span> <span class="mi">1</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
</div>
<div class="section" id="dates">
<span id="input-dates"></span><h3><a class="toc-backref" href="#id109">Dates</a></h3>
<p>Date fields are JavaScript objects, within which the &quot;date-parts&quot; element
is a nested JavaScript array containing a start
date and optional end date, each of which consists of a year,
an optional month and an optional day, in that order if present.</p>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">A simplified format for providing date input
is described below in the section
<img alt="link" src="link.png" /> <a class="reference internal" href="#dirty-tricks">Dirty Tricks</a> → <a class="reference internal" href="#input-data-rescue">Input data rescue</a> → <a class="reference internal" href="#dirty-dates">Dates</a>.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;issued&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;date-parts&quot;</span> <span class="o">:</span> <span class="p">[</span>
         <span class="p">[</span> <span class="s2">&quot;2000&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;15&quot;</span> <span class="p">]</span>
      <span class="p">]</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>Date elements may be expressed either as numeric strings or as
numbers.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;issued&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;date-parts&quot;</span> <span class="o">:</span> <span class="p">[</span>
         <span class="p">[</span> <span class="mi">1895</span><span class="p">,</span> <span class="mi">11</span> <span class="p">]</span>
      <span class="p">]</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>The <tt class="docutils literal">year</tt> element may be negative, but never zero.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;issued&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;date-parts&quot;</span> <span class="o">:</span> <span class="p">[</span>
         <span class="p">[</span> <span class="o">-</span><span class="mi">200</span> <span class="p">]</span>
      <span class="p">]</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>A <tt class="docutils literal">season</tt> element may
also be included.  If present, string or number values between <tt class="docutils literal">1</tt> and <tt class="docutils literal">4</tt>
will be interpreted to correspond to Spring, Summer, Fall, and Winter,
respectively.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;issued&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;date-parts&quot;</span> <span class="o">:</span> <span class="p">[</span>
         <span class="p">[</span> <span class="mi">1950</span> <span class="p">]</span>
      <span class="p">],</span>
      <span class="s2">&quot;season&quot;</span> <span class="o">:</span> <span class="s2">&quot;1&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>Other string values are permitted in the <tt class="docutils literal">season</tt> element,
but note that these will appear in the output
as literal strings, without localization:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;issued&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;date-parts&quot;</span> <span class="o">:</span> <span class="p">[</span>
         <span class="p">[</span> <span class="mi">1975</span> <span class="p">]</span>
      <span class="p">],</span>
      <span class="s2">&quot;season&quot;</span> <span class="o">:</span> <span class="s2">&quot;Trinity&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>For approximate dates, a <tt class="docutils literal">circa</tt> element should be included,
with a non-nil value:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;issued&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;date-parts&quot;</span> <span class="o">:</span> <span class="p">[</span>
         <span class="p">[</span> <span class="o">-</span><span class="mi">225</span> <span class="p">]</span>
      <span class="p">],</span>
      <span class="s2">&quot;circa&quot;</span> <span class="o">:</span> <span class="mi">1</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>To input a date range, add an array representing the end date,
with corresponding elements:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;issued&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;date-parts&quot;</span> <span class="o">:</span> <span class="p">[</span>
         <span class="p">[</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">11</span> <span class="p">],</span>
         <span class="p">[</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">12</span> <span class="p">]</span>
      <span class="p">]</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>To specify an open-ended range, pass nil values for the end elements:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;issued&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;date-parts&quot;</span> <span class="o">:</span> <span class="p">[</span>
         <span class="p">[</span> <span class="mi">2008</span><span class="p">,</span> <span class="mi">11</span> <span class="p">],</span>
         <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">]</span>
      <span class="p">]</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>A literal string may be passed through as a <tt class="docutils literal">literal</tt> element:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;issued&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;literal&quot;</span> <span class="o">:</span> <span class="s2">&quot;13th century&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
</div>
<div class="section" id="citation-data-object">
<h2><a class="toc-backref" href="#id110">Citation data object</a></h2>
<p>A minimal citation data object, used as input by both the <tt class="docutils literal">processCitationCluster()</tt>
and <tt class="docutils literal">appendCitationCluster()</tt> command, has the following form:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>
   <span class="s2">&quot;citationItems&quot;</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
         <span class="s2">&quot;id&quot;</span><span class="o">:</span> <span class="s2">&quot;ITEM-1&quot;</span>
      <span class="p">}</span>
   <span class="p">],</span>
   <span class="s2">&quot;properties&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;noteIndex&quot;</span><span class="o">:</span> <span class="mi">1</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>The <tt class="docutils literal">citationItems</tt> array is a list of one or more citation item
objects, each containing an <tt class="docutils literal">id</tt> used to retrieve the bibliographic
details of the target resource.  A citation item object may contain
one or more additional optional values:</p>
<ul class="simple">
<li><tt class="docutils literal">locator</tt>: a string identifying a page number or other pinpoint
location or range within the resource;</li>
<li><tt class="docutils literal">label</tt>: a label type, indicating whether the locator is to a
page, a chapter, or other subdivision of the target resource.  Valid
labels are defined in the <img alt="link" src="link.png" /> <a class="reference external" href="http://citationstyles.org/">CSL specification</a>.</li>
<li><tt class="docutils literal"><span class="pre">suppress-author</span></tt>: if true, author names will not be included in the
citation output for this cite;</li>
<li><tt class="docutils literal"><span class="pre">author-only</span></tt>: if true, only the author name will be included
in the citation output for this cite -- this optional parameter
provides a means for certain demanding styles that require the
processor output to be divided between the main text and a footnote.
(See the section <a class="reference internal" href="#processor-control">Processor control</a>, in the <a class="reference internal" href="#dirty-tricks">Dirty Tricks</a> section
below for more details.)</li>
<li><tt class="docutils literal">prefix</tt>: a string to print before this cite item;</li>
<li><tt class="docutils literal">suffix</tt>: a string to print after this cite item.</li>
</ul>
<p>In the <tt class="docutils literal">properties</tt> portion of a citation, the <tt class="docutils literal">noteIndex</tt>
value indicates the footnote number in which the citation is located
within the document.  Citations within the main text of the document
have a <tt class="docutils literal">noteIndex</tt> of zero.</p>
<p>The processor will add a number of data items to a citation
during processing.  Values added at the top level of the citation
structure include:</p>
<ul class="simple">
<li><tt class="docutils literal">citationID</tt>: A unique ID assigned to the citation, for
internal use by the processor.  This ID may be assigned by the
calling application, but it must uniquely identify the citation,
and it must not be changed during processing or during an
editing session.</li>
<li><tt class="docutils literal">sortedItems</tt>: This is an array of citation objects and accompanying
bibliographic data objects, sorted as required by the configured
style.  Calling applications should not need to access the data
in this array directly.</li>
</ul>
<p>Values added to individual citation item objects may include:</p>
<ul class="simple">
<li><tt class="docutils literal">sortkeys</tt>: an array of sort keys used by the processor to produce
the sorted list in <tt class="docutils literal">sortedItems</tt>.  Calling applications should not
need to touch this array directly.</li>
<li><tt class="docutils literal">position</tt>: an integer flag that indicates whether the cite item
should be rendered as a first reference, an immediately-following
reference (i.e. <em>ibid</em>), an immediately-following reference with locator
information, or a subsequent reference.</li>
<li><tt class="docutils literal"><span class="pre">first-reference-note-number</span></tt>: the number of the <tt class="docutils literal">noteIndex</tt> of
the first reference to this resource in the document.</li>
<li><tt class="docutils literal"><span class="pre">near-note</span></tt>: a boolean flag indicating whether another reference
to this resource can be found within a specific number of notes,
counting back from the current position.  What is &quot;near&quot; in
this sense is style-dependent.</li>
<li><tt class="docutils literal">unsorted</tt>: a boolean flag indicating whether sorting imposed
by the style should be suspended for this citation.  When true,
cites are rendered in the order in which they are presented
in <tt class="docutils literal">citationItems</tt>.</li>
</ul>
<div class="section" id="runtime-state-internal-objects-and-arrays">
<h3><a class="toc-backref" href="#id111">Runtime state: Internal objects and arrays</a></h3>
<p>Citations are registered and accessed by the processor internally
in arrays and JavaScript objects. Data that may be of use to
calling applications can be accessed at the following locations
(note that the content of these variables should not be modified
directly; the processor will update them automatically when
citation data is processed or updated via the API):</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="highlight"><pre><span class="nx">citeproc</span><span class="p">.</span><span class="nx">registry</span><span class="p">.</span><span class="nx">citationreg</span><span class="p">.</span><span class="nx">citationById</span>      <span class="c1">// (object, returns object)</span>

<span class="nx">citeproc</span><span class="p">.</span><span class="nx">registry</span><span class="p">.</span><span class="nx">citationreg</span><span class="p">.</span><span class="nx">citationsByItemId</span> <span class="c1">// (object, returns array)</span>

<span class="nx">citeproc</span><span class="p">.</span><span class="nx">registry</span><span class="p">.</span><span class="nx">citationreg</span><span class="p">.</span><span class="nx">citationByIndex</span>   <span class="c1">// (array of objects)</span>

<span class="nx">citeproc</span><span class="p">.</span><span class="nx">registry</span><span class="p">.</span><span class="nx">getSortedRegistryItems</span><span class="p">()</span>      <span class="c1">// (returns an array of</span>
                                                <span class="c1">// registry objects, with</span>
                                                <span class="c1">// ``uncited`` set ``true``</span>
                                                <span class="c1">// as appropriate, and</span>
                                                <span class="c1">// item data on key ``ref``)</span>
</pre></div>
</td></tr></table>
</div>
<table class="docutils footnote" frame="void" id="id34" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id29">[5]</a></td><td>For information on valid CSL variable names, please
refer to the CSL specification, available via <a class="reference external" href="http://citationstyles.org/">http://citationstyles.org/</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id35" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id31">[6]</a></td><td>The Latin and Cyrillic scripts are referred to here collectively
as &quot;Byzantine scripts&quot;, after the confluence of cultures in the first
millenium that spanned both.</td></tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="dirty-tricks">
<h1><a class="toc-backref" href="#id112">Dirty Tricks</a></h1>
<p>This section presents features of the <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> processor that
are not properly speaking a part of the CSL specification.  The
functionality described here may or may not be found in other CSL 1.0
compliant processors, when they arrive on the scene.</p>
<div class="section" id="supplementary-fields">
<h2><a class="toc-backref" href="#id113">Supplementary fields</a></h2>
<p>Where the calling application provides a user interface for adding and
editing bibliographic items, a limited set of fields is typically
provided for each if the item types recognized by the
application. Fields that map to valid CSL variables needed for a
particular type of reference may not be available.</p>
<p>If the calling application provides a mapping of the <tt class="docutils literal">note</tt> variable
to all types, the processor can parse missing fields out of this
variable, for use in rendering citations. This facility is intended
only for testing purposes.  It provides a means of illustrating
citation use cases, with a view to requesting an adjustment to the
field lists or the user interface of the calling application.  It should
not be relied upon as a permanent workaround in production data;
and it should <em>never</em> be used to add variables that are not in the
CSL specification.</p>
<p>The syntax for adding supplementary fields via the <tt class="docutils literal">note</tt> variable
is as follows:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span><span class="o">:</span><span class="nx">authority</span><span class="o">:</span><span class="nx">Superior</span> <span class="nx">Court</span> <span class="nx">of</span> <span class="nx">California</span><span class="p">}{</span><span class="o">:</span><span class="nx">section</span><span class="o">:</span><span class="nx">A</span><span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>Supplementary variables are read by the processor as flat strings, so names
and date parsing will not work with them.</p>
</div>
<div class="section" id="input-data-rescue">
<h2><a class="toc-backref" href="#id114">Input data rescue</a></h2>
<div class="section" id="id36">
<span id="dirty-names"></span><h3><a class="toc-backref" href="#id115">Names</a></h3>
<p>Systems that use a simple two-field entry format can encode
<tt class="docutils literal"><span class="pre">non-dropping-particle</span></tt>, <tt class="docutils literal"><span class="pre">dropping-particle</span></tt> and <tt class="docutils literal">suffix</tt> name
sub-elements by including them in the <tt class="docutils literal">family</tt> or
<tt class="docutils literal">given</tt> name fields as illustrated below.</p>
<p>By default, the processor will attempt to parse such names into
their component parts. Parsing can be disabled by setting the
<tt class="docutils literal">parse_names</tt> processor configuration flag to <tt class="docutils literal">false</tt>:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nx">citeproc</span><span class="p">.</span><span class="nx">opt</span><span class="p">.</span><span class="nx">development_extensions</span><span class="p">.</span><span class="nx">parse_names</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</pre></div>
</td></tr></table>
</div>
<div class="section" id="non-dropping-particle">
<h4><a class="toc-backref" href="#id116"><tt class="docutils literal"><span class="pre">non-dropping-particle</span></tt></a></h4>
<p>A string at the beginning of the <tt class="docutils literal">family</tt> field consisting
of spaces and lowercase roman or Cyrillic characters will
be treated as a <tt class="docutils literal"><span class="pre">non-dropping-particle</span></tt> (but see <a class="reference internal" href="#particles-as-part-of-the-last-name">Particles as part of the last name</a> below.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;van Gogh&quot;</span><span class="p">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Vincent&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="dropping-particle">
<h4><a class="toc-backref" href="#id117"><tt class="docutils literal"><span class="pre">dropping-particle</span></tt></a></h4>
<p>A string at the end of the <tt class="docutils literal">given</tt> name field consisting
of spaces and lowercase roman or Cyrillic characters will
be treated as a <tt class="docutils literal"><span class="pre">dropping-particle</span></tt>.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Humboldt&quot;</span><span class="p">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Alexander von&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="suffix-ordinary">
<h4><a class="toc-backref" href="#id118"><tt class="docutils literal">suffix</tt> (ordinary)</a></h4>
<p>Content following the first comma in the <tt class="docutils literal">given</tt> name field
will be parsed out as a name <tt class="docutils literal">suffix</tt>.</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;King&quot;</span><span class="p">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Martin Luther, Jr.&quot;</span>
    <span class="p">},</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Gates&quot;</span><span class="p">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;William Henry, III&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="suffix-forced-comma">
<h4><a class="toc-backref" href="#id119"><tt class="docutils literal">suffix</tt> (forced comma)</a></h4>
<p>Modern typographical convention does not place a comma between
suffixes such as &quot;Jr.&quot; and the last name, when rendering the name in
normal order: &quot;John Doe Jr.&quot;  If an individual prefers that the
traditional comma be used in rendering their name, the comma can be
forced by placing a exclamation mark after the initial comma that
marks the beginning of the suffix:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Bennett&quot;</span><span class="p">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Frank G.,! Jr.&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="dropping-particle-and-suffix">
<h4><a class="toc-backref" href="#id120"><tt class="docutils literal"><span class="pre">dropping-particle</span></tt> and <tt class="docutils literal">suffix</tt></a></h4>
<p>As noted above, a comma in the <tt class="docutils literal">given</tt> field marks the beginning of a suffix.
Parsing of dropping particles is limited to the portion of the <tt class="docutils literal">given</tt>
field that precedes any comma:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Moltke&quot;</span><span class="p">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Helmuth von, Sr.&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="particles-as-part-of-the-last-name">
<h4><a class="toc-backref" href="#id121">Particles as part of the last name</a></h4>
<p>The particles preceding some names should be treated
as part of the last name, depending on the cultural
heritage and personal preferences of the individual.
To suppress parsing and treat such particles as part
of the <tt class="docutils literal">family</tt> name field, enclose the <tt class="docutils literal">family</tt>
name field content in double-quotes:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;\&quot;van der Vlist\&quot;&quot;</span><span class="p">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Eric&quot;</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
</div>
<div class="section" id="id37">
<span id="dirty-dates"></span><h3><a class="toc-backref" href="#id122">Dates</a></h3>
<p>The <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> processor contains its own internal
parsing code for raw date strings.  Clients may take advantage of the
processor's internal parser by supplying date strings as a single
<tt class="docutils literal">raw</tt> element:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>  <span class="s2">&quot;issued&quot;</span> <span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;raw&quot;</span> <span class="o">:</span> <span class="s2">&quot;25 Dec 2004&quot;</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>Note that the parsing of raw date strings is not part of the CSL 1.0
standard.  Clients that need to interoperate with other CSL
processors should be capable of preparing input in the form described
above under <a class="reference internal" href="#data-input">Data Input</a> → <a class="reference internal" href="#input-dates">Dates</a>.</p>
</div>
</div>
<div class="section" id="processor-control">
<h2><a class="toc-backref" href="#id123">Processor control</a></h2>
<p>In ordinary operation, the processor generates citation strings
suitable for a given position in the document.  To support some use
cases, the processor is capable of delivering special-purpose
fragments of a citation.</p>
<div class="section" id="author-only">
<h3><a class="toc-backref" href="#id124"><tt class="docutils literal"><span class="pre">author-only</span></tt></a></h3>
<p>When the <tt class="docutils literal">makeCitationCluster()</tt> command (not documented here) is
invoked with a non-nil <tt class="docutils literal"><span class="pre">author-only</span></tt> element, everything but the
author name in a cite is suppressed.  The name is returned without
decorative markup (italics, superscript, and so forth).</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">my_ids</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">[</span><span class="s2">&quot;ID-1&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;author-only&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">}]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
<p>You might think that printing the author of a cited work,
without printing the cite itself, is a useless thing to do.
And if that were the end of the story, you would be right ...</p>
</div>
<div class="section" id="suppress-author">
<h3><a class="toc-backref" href="#id125"><tt class="docutils literal"><span class="pre">suppress-author</span></tt></a></h3>
<p>To suppress the rendering of names in a cite, include a <tt class="docutils literal"><span class="pre">suppress-author</span></tt>
element with a non-nil value in the supplementary data:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">my_ids</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="s2">&quot;ID-1&quot;</span><span class="p">,</span> <span class="p">{</span> <span class="s2">&quot;locator&quot;</span><span class="o">:</span> <span class="s2">&quot;21&quot;</span><span class="p">,</span> <span class="s2">&quot;suppress-author&quot;</span><span class="o">:</span> <span class="mi">1</span> <span class="p">}]</span>
<span class="p">]</span>
</pre></div>
</td></tr></table>
</div>
<p>This option is useful on its own.  It can also be used in
combination with the <tt class="docutils literal"><span class="pre">author-only</span></tt> element, as described below.</p>
</div>
<div class="section" id="automating-text-insertions">
<h3><a class="toc-backref" href="#id126">Automating text insertions</a></h3>
<p>Calls to the <tt class="docutils literal">makeCitationCluster()</tt> command with the <tt class="docutils literal"><span class="pre">author-only</span></tt>
and to <tt class="docutils literal">processCitationCluster()</tt> or <tt class="docutils literal">appendCitationCluster()</tt> with the
<tt class="docutils literal"><span class="pre">suppress-author</span></tt> control elements can be used to produce
cites that divide their content into two parts.  This permits the
support of styles such as the Chinese national standard style GB7714-87,
which requires formatting like the following:</p>
<blockquote>
<p><strong>The Discovery of Wetness</strong></p>
<p>While it has long been known that rocks are dry <sup>[1]</sup>
and that air is moist <sup>[2]</sup> it has been suggested by Source [3] that
water is wet.</p>
<p><strong>Bibliography</strong></p>
<p>[1] John Noakes, <em>The Dryness of Rocks</em> (1952).</p>
<p>[2] Richard Snoakes, <em>The Moistness of Air</em> (1967).</p>
<p>[3] Jane Roe, <em>The Wetness of Water</em> (2000).</p>
</blockquote>
<p>In an author-date style, the same passage should be rendered more or
less as follows:</p>
<blockquote>
<p><strong>The Discovery of Wetness</strong></p>
<p>While it has long been known that rocks are dry (Noakes 1952)
and that air is moist (Snoakes 1967) it has been suggested by Roe (2000)
that water is wet.</p>
<p><strong>Bibliography</strong></p>
<p>John Noakes, <em>The Dryness of Rocks</em> (1952).</p>
<p>Richard Snoakes, <em>The Moistness of Air</em> (1967).</p>
<p>Jane Roe, <em>The Wetness of Water</em> (2000).</p>
</blockquote>
<p>In both of the example passages above, the cites to Noakes and Snoakes
can be obtained with ordinary calls to citation processing commands.  The
cite to Roe must be obtained in two parts: the first with a call
controlled by the <tt class="docutils literal"><span class="pre">author-only</span></tt> element; and the second with
a call controlled by the <tt class="docutils literal"><span class="pre">suppress-author</span></tt> element, <em>in that order</em>:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">my_ids</span> <span class="o">=</span> <span class="p">{</span>
  <span class="p">[</span><span class="s2">&quot;ID-3&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;author-only&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">}]</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">citeproc</span><span class="p">.</span><span class="nx">makeCitationCluster</span><span class="p">(</span> <span class="nx">my_ids</span> <span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<p>... and then ...</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">citation</span><span class="p">,</span> <span class="nx">result</span><span class="p">;</span>

<span class="nx">citation</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">&quot;citationItems&quot;</span><span class="o">:</span> <span class="p">[</span><span class="s2">&quot;ID-3&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;suppress-author&quot;</span><span class="o">:</span> <span class="mi">1</span><span class="p">}],</span>
  <span class="s2">&quot;properties&quot;</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&quot;noteIndex&quot;</span><span class="o">:</span> <span class="mi">5</span> <span class="p">}</span>
<span class="p">}</span>

<span class="p">[</span><span class="nx">data</span><span class="p">,</span> <span class="nx">result</span><span class="p">]</span> <span class="o">=</span> <span class="nx">citeproc</span><span class="p">.</span><span class="nx">processCitationCluster</span><span class="p">(</span> <span class="nx">citation</span> <span class="p">);</span>
</pre></div>
</td></tr></table>
</div>
<p>In the first call, the processor will automatically suppress decorations (superscripting).
Also in the first call, if a numeric style is used, the processor will provide a localized
label in lieu of the author name, and include the numeric source identifier, free of decorations.
In the second call, if a numeric style is used, the processor will suppress output, since
the numeric identifier was included in the return to the first call.</p>
<p>Detailed illustrations of the interaction of these two control
elements are in the processor test fixtures in the
&quot;discretionary&quot; category:</p>
<ul class="simple">
<li><img alt="link" src="link.png" /> <a class="reference external" href="http://bitbucket.org/bdarcus/citeproc-test/src/tip/processor-tests/humans/discretionary_AuthorOnly.txt">AuthorOnly</a></li>
<li><img alt="link" src="link.png" /> <a class="reference external" href="http://bitbucket.org/bdarcus/citeproc-test/src/tip/processor-tests/humans/discretionary_CitationNumberAuthorOnlyThenSuppressAuthor.txt">CitationNumberAuthorOnlyThenSuppressAuthor</a></li>
<li><img alt="link" src="link.png" /> <a class="reference external" href="http://bitbucket.org/bdarcus/citeproc-test/src/tip/processor-tests/humans/discretionary_CitationNumberSuppressAuthor.txt">CitationNumberSuppressAuthor</a></li>
<li><img alt="link" src="link.png" /> <a class="reference external" href="http://bitbucket.org/bdarcus/citeproc-test/src/tip/processor-tests/humans/discretionary_SuppressAuthorSolo.txt">SuppressAuthorSolo</a></li>
</ul>
</div>
</div>
<div class="section" id="id43">
<span id="multilingual-content"></span><h2><a class="toc-backref" href="#id127">Multilingual content</a></h2>
<p>The version of <tt class="docutils literal"><span class="pre">citeproc-js</span></tt> described by this manual incorporates
a mechanism for supporting cross-lingual and
mixed-language citation styles, such as 我妻栄 [Wagatsuma Sakae],
<span class="sc">債権各論 [Obligations in Detail]</span> (1969). The scheme
described below should be considered experimental for the
present. The code is intended for deployment in the
Zotero reference manager; when it is eventually accepted for deployment (possibly with
further modifications), the implementation can be considered
stable.</p>
<div class="section" id="selecting-multilingual-variants">
<h3><a class="toc-backref" href="#id128">Selecting multilingual variants</a></h3>
<p>For multilingual operation, a style may be set to request alternative
versions and translations of the <tt class="docutils literal">title</tt> field, and of the author
and other name fields.  There are two methods of setting multilingual
parameters: via <tt class="docutils literal"><span class="pre">default-locale</span></tt> (intended primarily for testing) and
via API methods (intended for production use).</p>
<p>When set via <tt class="docutils literal"><span class="pre">default-locale</span></tt>, extensions consist of an extension tag, followed by
a language setting that conforms to <img alt="link" src="link.png" /> <a class="reference external" href="http://www.ietf.org/rfc/rfc5646.txt">RFC 5646</a> (typically constructed
from components listed in the <img alt="link" src="link.png" /> <a class="reference external" href="http://www.iana.org/assignments/language-subtag-registry">IANA Language Subtag Registry</a>).
When set via an API method, the argument to the appropriate method should
be a list of RFC 5646 language tags.</p>
<p>Recognized extension
tags for use with <tt class="docutils literal"><span class="pre">default-locale</span></tt> [and corresponding API methods] are as follows:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">-x-pri-</span></tt> [<tt class="docutils literal">setLangTagsForCslTransliteration()</tt>]</dt>
<dd>Sets a preferred language for transliterations.</dd>
<dt><tt class="docutils literal"><span class="pre">-x-sec-</span></tt> [<tt class="docutils literal">setLangTagsForCslTranslation()</tt>]</dt>
<dd>Sets an optional secondary translation for the title field.
If this tag is present, a translation in the target language
will (if available) be placed in square braces immediately  after the title text.</dd>
<dt><tt class="docutils literal"><span class="pre">-x-sort-</span></tt> [<tt class="docutils literal">setLangTagsForCslSort()</tt>]</dt>
<dd>Sets the preferred language or transliteration to be used for both the
title field and for names in sort keys.</dd>
</dl>
<p>An example of <tt class="docutils literal"><span class="pre">default-locale</span></tt> configuration:</p>
<div class="codeblock xml">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;style</span>
    <span class="na">xmlns=</span><span class="s">&quot;http://purl.org/net/xbiblio/csl&quot;</span>
    <span class="na">class=</span><span class="s">&quot;in-text&quot;</span>
    <span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
    <span class="na">default-locale=</span><span class="s">&quot;en-US-x-pri-ja-Hrkt&quot;</span><span class="nt">&gt;</span>
</pre></div>
</td></tr></table>
</div>
<p>Multiple tags may be specified, and tags are cumulative. For
readability in test fixtures, individual tags may be separated by newlines within the
attribute.  The following will attempt to render titles in either
Pinyin transliteration (for Chinese titles) or Hepburn romanization
(for Japanese titles), sorting by the transliteration.</p>
<div class="codeblock xml">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span class="nt">&lt;style</span>
    <span class="na">xmlns=</span><span class="s">&quot;http://purl.org/net/xbiblio/csl&quot;</span>
    <span class="na">class=</span><span class="s">&quot;in-text&quot;</span>
    <span class="na">version=</span><span class="s">&quot;1.0&quot;</span>
    <span class="na">default-locale=</span><span class="s">&quot;en-US</span>
<span class="s">        -x-pri-zh-Latn-pinyin</span>
<span class="s">        -x-pri-ja-Latn-hepburn</span>
<span class="s">        -x-sort-zh-Latn-pinyin</span>
<span class="s">        -x-sort-ja-Latn-hepburn&quot;</span><span class="nt">&gt;</span>
</pre></div>
</td></tr></table>
</div>
<p>An example of API configuration:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="nx">citeproc</span><span class="p">.</span><span class="nx">setLangTagsForCslSort</span><span class="p">([</span><span class="s2">&quot;zh-alalc97&quot;</span><span class="p">,</span> <span class="s2">&quot;ja-alalc97&quot;</span><span class="p">]);</span>
</pre></div>
</td></tr></table>
</div>
<p>The processor offers three boolean API methods that are not available
via <tt class="docutils literal"><span class="pre">default-locale</span></tt>:</p>
<dl class="docutils">
<dt><tt class="docutils literal">setOriginalCreatorNameFormsOption()</tt></dt>
<dd>With argument <tt class="docutils literal">true</tt>, instructs the processor to append the
personal names in their original form in parentheses after transliterations.
Default is <tt class="docutils literal">false</tt>.</dd>
<dt><tt class="docutils literal">setOriginalCreatorNameFormatOption()</tt></dt>
<dd>With argument <tt class="docutils literal">true</tt>, instructs the processor to use the
name-part ordering conventions appropriate to the original form
of personal names when transliterating.  When this option
is in effect, names represented in a non-Byzantine script
in their original form will not have their given name part
truncated to initials, regardless of the setting provided
by the CSL style. Default is <tt class="docutils literal">false</tt>.</dd>
<dt><tt class="docutils literal">setAutoVietnameseNamesOption()</tt></dt>
<dd>With argument <tt class="docutils literal">true</tt>, the processor will attempt to
identify Vietnamese names, and format them correctly,
with the family name always in first position. Default
is <tt class="docutils literal">false</tt>, because there is a small possibility of
false positives when this code is enabled.</dd>
</dl>
</div>
<div class="section" id="data-format">
<h3><a class="toc-backref" href="#id129">Data format</a></h3>
<p>Multilingual operation depends upon the presence of alternative
representations of field content embedded in the item data.  When
alternative field content is not availaable, the &quot;real&quot; field content
is used as a fallback.  As a result, configuration of language and
script selection parameters will have no effect when only a single
language is available (as will normally be the case for an ordinary
Zotero data store).</p>
<div class="section" id="title">
<h4><a class="toc-backref" href="#id130">Title</a></h4>
<p>For titles and other ordinary string fields, alternative representations are
placed in a separate <tt class="docutils literal">multi</tt> segment on the item, keyed to the
field name and the language tag (note the use of the <tt class="docutils literal">_keys</tt> element on the
<tt class="docutils literal">multi</tt> object):</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;title&quot;</span> <span class="o">:</span> <span class="s2">&quot;民法&quot;</span><span class="p">,</span>
  <span class="s2">&quot;multi&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;_keys&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;title&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;ja-alalc97&quot;</span><span class="o">:</span> <span class="s2">&quot;Minpō&quot;</span><span class="p">,</span>
        <span class="s2">&quot;en&quot;</span><span class="o">:</span><span class="s2">&quot;Civil Code&quot;</span>
      <span class="p">}</span>
        <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="id46">
<h4><a class="toc-backref" href="#id131">Names</a></h4>
<p>For names, alternative representations are set on a <tt class="docutils literal">multi</tt>
segment of the name object itself (note the use of the <tt class="docutils literal">_key</tt>
element on the <tt class="docutils literal">multi</tt> object):</p>
<div class="admonition-hint admonition">
<p class="first admonition-title">Hint</p>
<p class="last">As described above, fixed ordering is used for
<a class="reference internal" href="#input-byzantine">non-Byzantine names</a>.  When such
names are transliterated, the <tt class="docutils literal"><span class="pre">static-ordering</span></tt> element is
set on them, to preserve their original formatting behavior.</p>
</div>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span> <span class="s2">&quot;author&quot;</span> <span class="o">:</span> <span class="p">[</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;穂積&quot;</span><span class="p">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;陳重&quot;</span><span class="p">,</span>
      <span class="s2">&quot;multi&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;_key&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;ja-alalc97&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Hozumi&quot;</span><span class="p">,</span>
            <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Nobushige&quot;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span> <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;中川&quot;</span><span class="p">,</span>
      <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;善之助&quot;</span>
      <span class="s2">&quot;multi&quot;</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;_key&quot;</span><span class="o">:</span> <span class="p">{</span>
          <span class="s2">&quot;ja-alalc97&quot;</span><span class="o">:</span> <span class="p">{</span>
            <span class="s2">&quot;family&quot;</span> <span class="o">:</span> <span class="s2">&quot;Nakagawa&quot;</span><span class="p">,</span>
            <span class="s2">&quot;given&quot;</span> <span class="o">:</span> <span class="s2">&quot;Zennosuke&quot;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="date-parser">
<h1><a class="toc-backref" href="#id132">Date parser</a></h1>
<p>A parser that converts human-readable dates to a structured form
is available as a self-contained module, under the name <tt class="docutils literal">CSL.DateParser</tt>.</p>
<div class="section" id="instantiation-csl-dateparser">
<h2><a class="toc-backref" href="#id133">Instantiation: <tt class="docutils literal">CSL.DateParser</tt></a></h2>
<p>When used as a standalone module, the parser must be instantiated in
the usual way before use:</p>
<div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CSL</span><span class="p">.</span><span class="nx">DateParser</span><span class="p">;</span>
</pre></div>
</td></tr></table>
</div>
</div>
<div class="section" id="parser-methods">
<h2><a class="toc-backref" href="#id134">Parser methods</a></h2>
<p>The following methods are available on the parser object, to control
parsing behavior and to parse string input.</p>
<dl class="docutils">
<dt><tt class="docutils literal">parser.parse(str)</tt></dt>
<dd>Parse the string <tt class="docutils literal">str</tt> and return a date object.
Within the date object, the parsed date may be represented
either as a set of key/value pairs (see <tt class="docutils literal">returnAsKeys()</tt>,
below), or as a nested array under a <tt class="docutils literal"><span class="pre">date-parts</span></tt> key
(see <tt class="docutils literal">returnAsArray()</tt>, below).</dd>
<dt><tt class="docutils literal">parser.returnAsArray()</tt></dt>
<dd><p class="first">Set the date value on the date object returned by
the <tt class="docutils literal">parse()</tt> method as a nested array under
a <tt class="docutils literal"><span class="pre">date-parts</span></tt> key.  For example, the date range
31 January 2000 to 28 February 2001 would look like
this in array format:</p>
<div class="last"><div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>
  <span class="s2">&quot;date-parts&quot;</span><span class="o">:</span> <span class="p">[</span>
    <span class="p">[</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2001</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">28</span><span class="p">]</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div></dd>
<dt><tt class="docutils literal">parser.returnAsKeys()</tt> [default]</dt>
<dd><p class="first">Set the date value on the date object returned by
the <tt class="docutils literal">parse()</tt> method as a set of name/value pairs.
For example, the date range
31 January 2000 to 28 February 2001 would look like
this in keys format:</p>
<div class="last"><div class="codeblock js">
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="p">{</span>
  <span class="nx">year</span><span class="o">:</span> <span class="mi">2000</span><span class="p">,</span>
  <span class="nx">month</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
  <span class="nx">day</span><span class="o">:</span> <span class="mi">31</span><span class="p">,</span>
  <span class="nx">year_end</span><span class="o">:</span> <span class="mi">2001</span><span class="p">,</span>
  <span class="nx">month_end</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
  <span class="nx">day_end</span><span class="o">:</span> <span class="mi">28</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
</div>
</div></dd>
<dt><tt class="docutils literal">parser.setOrderMonthDay()</tt> [default]</dt>
<dd>When parsing human-readable numeric dates, assume mm/dd/yyyy ordering.</dd>
<dt><tt class="docutils literal">parser.setOrderDayMonth()</tt></dt>
<dd>When parsing human-readable numeric dates, assume dd/mm/yyyy ordering.</dd>
<dt><tt class="docutils literal">parser.addMonths(str)</tt></dt>
<dd>Extend the parser to recognize a set of 12 additional space-delimited human-readable
text months.  The parser so extended will recognize months by their first
three characters, unless additional characters are required to distinguish
between different months with similar names.  To extend also by seasons,
add four additional season names to the space-delimited list of names
(for a list of 16 names).</dd>
<dt><tt class="docutils literal">parser.resetMonths()</tt></dt>
<dd>Reset month recognition to the default of <tt class="docutils literal">jan feb mar apr may
jun jul aug sep oct nov dec spr sum fal win</tt>.</dd>
</dl>
</div>
</div>
<div class="section" id="test-suite">
<h1><a class="toc-backref" href="#id135">Test Suite</a></h1>
<div class="admonition-important admonition">
<p class="first admonition-title">Important</p>
<p class="last">Note that the standard CSL test fixtures are not distributed
with the processor, and must be added to the source tree
separately.</p>
</div>
<p><tt class="docutils literal"><span class="pre">Citeproc-js</span></tt> ships with a large bundle of test data and a set of
scripts that can be used to confirm that the system performs correctly
after installation.  The tests begin as individual human-friendly
fixtures written in a special format, shown in the sample file
immediately below.  Tests are prepared for use by grinding them into a
machine-friendly form (JSON), and by preparing an appropriate JavaScript
execution wrapper for each.  These operations are performed automatically
by the top-level test runner script that ships with the sources.</p>
<div class="section" id="running-the-test-suite">
<h2><a class="toc-backref" href="#id136">Running the test suite</a></h2>
<p>Tests are controlled by the <tt class="docutils literal">./test.py</tt> script in the root
directory of the archive.  To run all standard tests in the suite using
the <tt class="docutils literal">rhino</tt> interpreted shipped with the processor, use
the following command:</p>
<pre class="literal-block">
./test.py -s
</pre>
<p>Options and arguments can be used to select an alternative
JavaScript interpreter, or  to change or limit the set of tests
run.  The script options are as follows:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">--help</span></tt>:</dt>
<dd>List the script options with a brief description
of each and exit</dd>
<dt><tt class="docutils literal"><span class="pre">--standard</span></tt></dt>
<dd>Run standard tests.</dd>
<dt><tt class="docutils literal"><span class="pre">--release</span></tt></dt>
<dd>Bundle processor, apply license to files, and test with
bundled code.</dd>
<dt><tt class="docutils literal"><span class="pre">--cranky</span></tt></dt>
<dd>validate style code for testing against the
CSL schema using the <tt class="docutils literal">jing</tt> XML tool.</dd>
<dt><tt class="docutils literal"><span class="pre">--grind</span></tt></dt>
<dd>Force grinding of human-readable test code into machine-
readable form.</dd>
<dt><tt class="docutils literal"><span class="pre">--styles</span></tt></dt>
<dd>Run style tests only (style tests are not currently available)</dd>
<dt><tt class="docutils literal"><span class="pre">--processor</span></tt></dt>
<dd>Run processor tests (cannot be used with the <tt class="docutils literal"><span class="pre">-c</span></tt>, <tt class="docutils literal"><span class="pre">-g</span></tt> or <tt class="docutils literal"><span class="pre">-s</span></tt>
opts, takes only test name as single argument).</dd>
<dt><tt class="docutils literal"><span class="pre">--verbose</span></tt></dt>
<dd>Display test names during processing.</dd>
<dt><tt class="docutils literal"><span class="pre">--bundle-only</span></tt></dt>
<dd>Build the <tt class="docutils literal">citeproc.js</tt> bundle and exit.</dd>
</dl>
</div>
<div class="section" id="fixture-layout">
<h2><a class="toc-backref" href="#id137">Fixture layout</a></h2>
<p>For information on the layout of the test fixtures, see
the <a class="reference external" href="http://gsl-nagoya-u.net/http/pub/citeproc-test.html">CSL Test Suite</a> manual.</p>
</div>
</div>
<div class="section" id="live-demo">
<h1><a class="toc-backref" href="#id138">Live Demo</a></h1>
<p>When accessed using a JavaScript-enabled browser with E4X support
(such as <img alt="link" src="link.png" /> <a class="reference external" href="http://www.mozilla.com/">Firefox</a>), the <tt class="docutils literal">./demo/demo.html</tt> file in the source archive
(or <img alt="link" src="link.png" /> <a class="reference external" href="http://gsl-nagoya-u.net/http/pub/citeproc-demo/demo.html">online</a>) will invoke the processor to render a few citations.  The JavaScript
files accompanying the page in the <tt class="docutils literal">./demo</tt> directory show the basic
steps required to load and run the processor, whether in the browser
or server-side.</p>
</div>
</div>
</body>
</html>
