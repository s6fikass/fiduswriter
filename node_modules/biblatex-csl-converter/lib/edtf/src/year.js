'use strict';

var _typeof2 = require('babel-runtime/helpers/typeof');

var _typeof3 = _interopRequireDefault(_typeof2);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _weakMap = require('babel-runtime/core-js/weak-map');

var _weakMap2 = _interopRequireDefault(_weakMap);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var assert = require('assert');
var ExtDate = require('./date');
var ExtDateTime = require('./interface');
var pad = ExtDate.pad;
var abs = Math.abs;


var V = new _weakMap2.default();
var S = new _weakMap2.default();

var Year = function (_ExtDateTime) {
  (0, _inherits3.default)(Year, _ExtDateTime);

  function Year(input) {
    (0, _classCallCheck3.default)(this, Year);

    var _this = (0, _possibleConstructorReturn3.default)(this, (Year.__proto__ || (0, _getPrototypeOf2.default)(Year)).call(this));

    V.set(_this, []);

    switch (typeof input === 'undefined' ? 'undefined' : (0, _typeof3.default)(input)) {
      case 'number':
        _this.year = input;
        break;

      case 'string':
        input = Year.parse(input);
      // eslint-disable-line no-fallthrough

      case 'object':
        if (Array.isArray(input)) input = { values: input };

        {
          assert(input !== null);
          if (input.type) assert.equal('Year', input.type);

          assert(input.values);
          assert(input.values.length);

          _this.year = input.values[0];
          _this.significant = input.significant;
        }
        break;

      case 'undefined':
        _this.year = new Date().getUTCFullYear();
        break;

      default:
        throw new RangeError('Invalid year value');
    }
    return _this;
  }

  (0, _createClass3.default)(Year, [{
    key: 'toEDTF',
    value: function toEDTF() {
      var y = abs(this.year);
      var s = this.significant ? 'S' + this.significant : '';

      if (y < 9999) return '' + pad(this.year) + s;

      // TODO exponential form for ending zeroes

      return 'Y' + this.year + s;
    }
  }, {
    key: 'year',
    get: function get() {
      return this.values[0];
    },
    set: function set(year) {
      return this.values[0] = Number(year);
    }
  }, {
    key: 'significant',
    get: function get() {
      return S.get(this);
    },
    set: function set(digits) {
      return S.set(this, Number(digits));
    }
  }, {
    key: 'values',
    get: function get() {
      return V.get(this);
    }
  }, {
    key: 'min',
    get: function get() {
      return ExtDateTime.UTC(this.year, 0);
    }
  }, {
    key: 'max',
    get: function get() {
      return ExtDateTime.UTC(this.year + 1, 0) - 1;
    }
  }]);
  return Year;
}(ExtDateTime);

module.exports = Year;