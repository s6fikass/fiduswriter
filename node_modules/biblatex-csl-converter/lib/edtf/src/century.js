'use strict';

var _typeof2 = require('babel-runtime/helpers/typeof');

var _typeof3 = _interopRequireDefault(_typeof2);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _weakMap = require('babel-runtime/core-js/weak-map');

var _weakMap2 = _interopRequireDefault(_weakMap);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var assert = require('assert');
var ExtDate = require('./date');
var ExtDateTime = require('./interface');
var abs = Math.abs,
    floor = Math.floor;


var V = new _weakMap2.default();

var Century = function (_ExtDateTime) {
  (0, _inherits3.default)(Century, _ExtDateTime);

  function Century(input) {
    (0, _classCallCheck3.default)(this, Century);

    var _this = (0, _possibleConstructorReturn3.default)(this, (Century.__proto__ || (0, _getPrototypeOf2.default)(Century)).call(this));

    V.set(_this, []);

    _this.uncertain = false;
    _this.approximate = false;

    switch (typeof input === 'undefined' ? 'undefined' : (0, _typeof3.default)(input)) {
      case 'number':
        _this.century = input;
        break;

      case 'string':
        input = Century.parse(input);
      // eslint-disable-line no-fallthrough

      case 'object':
        if (Array.isArray(input)) input = { values: input };

        {
          assert(input !== null);
          if (input.type) assert.equal('Century', input.type);

          assert(input.values);
          assert(input.values.length === 1);

          _this.century = input.values[0];
          _this.uncertain = !!input.uncertain;
          _this.approximate = !!input.approximate;
        }
        break;

      case 'undefined':
        _this.year = new Date().getUTCFullYear();
        break;

      default:
        throw new RangeError('Invalid century value');
    }
    return _this;
  }

  (0, _createClass3.default)(Century, [{
    key: 'toEDTF',
    value: function toEDTF() {
      var century = Century.pad(this.century);

      if (this.uncertain) century = century + '?';

      if (this.approximate) century = (century + '~').replace(/\?~/, '%');

      return century;
    }
  }, {
    key: 'century',
    get: function get() {
      return this.values[0];
    },
    set: function set(century) {
      century = floor(Number(century));
      assert(abs(century) < 100, 'invalid century: ' + century);
      return this.values[0] = century;
    }
  }, {
    key: 'year',
    get: function get() {
      return this.values[0] * 100;
    },
    set: function set(year) {
      return this.century = year / 100;
    }
  }, {
    key: 'values',
    get: function get() {
      return V.get(this);
    }
  }, {
    key: 'min',
    get: function get() {
      return ExtDate.UTC(this.year, 0);
    }
  }, {
    key: 'max',
    get: function get() {
      return ExtDate.UTC(this.year + 100, 0) - 1;
    }
  }], [{
    key: 'pad',
    value: function pad(number) {
      var k = abs(number);
      var sign = k === number ? '' : '-';

      if (k < 10) return sign + '0' + k;

      return '' + number;
    }
  }]);
  return Century;
}(ExtDateTime);

module.exports = Century;