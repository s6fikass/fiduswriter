'use strict';

var _require = require('..'),
    Bitmask = _require.Bitmask;

describe('Bitmask', function () {

  describe('instance', function () {
    var bm = void 0;
    beforeEach(function () {
      return bm = new Bitmask();
    });

    it('is zero by default', function () {
      expect(bm.value).to.be.zero;
      expect(bm.test()).to.be.zero;
      expect(bm.test('day')).to.be.zero;
      expect(bm.test('month')).to.be.zero;
      expect(bm.test('year')).to.be.zero;
    });

    describe('.mask()', function () {
      it('YYYYMMXX', function () {
        return expect(bm.set('day').mask().join('')).to.eql('YYYYMMXX');
      });

      it('YYYYXXDD', function () {
        return expect(bm.set('month').mask().join('')).to.eql('YYYYXXDD');
      });

      it('XXXXMMDD', function () {
        return expect(bm.set('year').mask().join('')).to.eql('XXXXMMDD');
      });
    });

    describe('.toString()', function () {
      it('YYYY-MM-DD', function () {
        return expect(bm.toString()).to.eql('YYYY-MM-DD');
      });

      it('YYYY-MM-XX', function () {
        return expect(bm.set('day').toString()).to.eql('YYYY-MM-XX');
      });
    });
  });

  describe('.max()', function () {
    it('year', function () {
      expect(new Bitmask().max(['2016'])).to.eql([2016]);
      expect(new Bitmask('year').max(['2016'])).to.eql([9999]);
      expect(new Bitmask('yxyxmmdd').max(['2016'])).to.eql([2919]);
    });

    it('month', function () {
      expect(new Bitmask().max(['2016', '01'])).to.eql([2016, 0]);
      expect(new Bitmask('yyyyxxdd').max(['2016', '01'])).to.eql([2016, 11]);
      expect(new Bitmask('yyyymxdd').max(['2016', '01'])).to.eql([2016, 8]);
      expect(new Bitmask('yyyymxdd').max(['2016', '10'])).to.eql([2016, 11]);
      expect(new Bitmask('yyyyxmdd').max(['2016', '01'])).to.eql([2016, 10]);
      expect(new Bitmask('yyyyxmdd').max(['2016', '02'])).to.eql([2016, 11]);
      expect(new Bitmask('yyyyxmdd').max(['2016', '03'])).to.eql([2016, 2]);
    });

    it('day', function () {
      expect(new Bitmask().max(['2016', '01', '01'])).to.eql([2016, 0, 1]);
      expect(new Bitmask('yyyymmxx').max(['2016', '01', '01'])).to.eql([2016, 0, 31]);
      expect(new Bitmask('yyyymmxx').max(['2016', '02', '01'])).to.eql([2016, 1, 29]);
      expect(new Bitmask('yyyymmxx').max(['2016', '04', '01'])).to.eql([2016, 3, 30]);
    });
  });

  describe('.test()', function () {
    it('true', function () {
      expect(Bitmask.test(true, true)).to.be.ok;
      expect(Bitmask.test(true, 'day')).to.be.ok;
      expect(Bitmask.test(true, 'month')).to.be.ok;
      expect(Bitmask.test(true, 'year')).to.be.ok;
      expect(Bitmask.test(true, false)).to.be.zero;
    });

    it('day', function () {
      expect(Bitmask.test('day', 'day')).to.be.ok;
      expect(Bitmask.test('day', 'month')).to.be.zero;
      expect(Bitmask.test('day', 'year')).to.be.zero;
      expect(Bitmask.test('day', true)).to.be.ok;
    });

    it('month', function () {
      expect(Bitmask.test('month', 'month')).to.be.ok;
      expect(Bitmask.test('month', 'year')).to.be.zero;
      expect(Bitmask.test('month', 'day')).to.be.zero;
      expect(Bitmask.test('month', true)).to.be.ok;
      expect(Bitmask.test('month', Bitmask.Y)).to.be.zero;
      expect(Bitmask.test('month', Bitmask.YM)).to.be.ok;
      expect(Bitmask.test('month', Bitmask.YMD)).to.be.ok;
    });

    it('year', function () {
      expect(Bitmask.test('year', 'year')).to.be.ok;
      expect(Bitmask.test('year', 'day')).to.be.zero;
      expect(Bitmask.test('year', 'month')).to.be.zero;
      expect(Bitmask.test('year', true)).to.be.ok;
      expect(Bitmask.test('year', Bitmask.Y)).to.be.ok;
      expect(Bitmask.test('year', Bitmask.YM)).to.be.ok;
      expect(Bitmask.test('year', Bitmask.YMD)).to.be.ok;
      expect(Bitmask.test('year', Bitmask.YYXX)).to.be.ok;
      expect(Bitmask.test('year', Bitmask.YYYX)).to.be.ok;
      expect(Bitmask.test('year', Bitmask.XXXX)).to.be.ok;
    });

    it('false', function () {
      expect(Bitmask.test(false, false)).to.be.zero;
      expect(Bitmask.test(false, 'day')).to.be.zero;
      expect(Bitmask.test(false, 'month')).to.be.zero;
      expect(Bitmask.test(false, 'year')).to.be.zero;
      expect(Bitmask.test(false, true)).to.be.zero;
    });
  });

  describe('.values()', function () {
    it('XXXXXXXX', function () {
      expect(Bitmask.values('XXXXXXXX')).to.eql([0, 0, 1]);
      expect(Bitmask.values('XXXXXXXX', 9)).to.eql([9999, 11, 31]);
    });

    it('XXXXXXDD', function () {
      expect(Bitmask.values('XXXXXX31')).to.eql([0, 0, 31]);
      expect(Bitmask.values('XXXXXX31', 9)).to.eql([9999, 11, 31]);
    });

    it('XXXXMMXX', function () {
      expect(Bitmask.values('XXXX05XX')).to.eql([0, 4, 1]);
      expect(Bitmask.values('XXXX05XX', 9)).to.eql([9999, 4, 31]);
      expect(Bitmask.values('XXXX02XX', 9)).to.eql([9999, 1, 29]);
      expect(Bitmask.values('XXXX06XX', 9)).to.eql([9999, 5, 30]);
    });

    it('YYYYXXXX', function () {
      expect(Bitmask.values('2014XXXX')).to.eql([2014, 0, 1]);
      expect(Bitmask.values('2014XXXX', 9)).to.eql([2014, 11, 31]);
    });

    it('XXXXXXDX', function () {
      expect(Bitmask.values('XXXXXX3X')).to.eql([0, 0, 30]);
      expect(Bitmask.values('XXXXXX3X', 9)).to.eql([9999, 11, 31]);
      expect(Bitmask.values('XXXXXX2X')).to.eql([0, 0, 20]);
      expect(Bitmask.values('XXXXXX2X', 9)).to.eql([9999, 11, 29]);
    });

    it('XXXXMXXX', function () {
      expect(Bitmask.values('XXXX0XXX')).to.eql([0, 0, 1]);
      expect(Bitmask.values('XXXX0XXX', 9)).to.eql([9999, 8, 30]);
      expect(Bitmask.values('XXXX1XXX')).to.eql([0, 9, 1]);
      expect(Bitmask.values('XXXX1XXX', 9)).to.eql([9999, 11, 31]);
    });

    it('XXXXMX', function () {
      expect(Bitmask.values('XXXX0X')).to.eql([0, 0]);
      expect(Bitmask.values('XXXX0X', 9)).to.eql([9999, 8]);
      expect(Bitmask.values('XXXX1X')).to.eql([0, 9]);
      expect(Bitmask.values('XXXX1X', 9)).to.eql([9999, 11]);
    });
  });
});